# cidr_ping.yml
- hosts: localhost
  gather_facts: no
  vars:
    my_cidr: "10.168.0.0/22"
  tasks:
    - name: Expand CIDR into host list
      set_fact:
        cidr_hosts: "{{ query('community.general.ipaddr', my_cidr) }}"

    - name: Add hosts dynamically
      add_host:
        name: "{{ item }}"
        groups: cidr_targets
        ansible_user: deploy
        ansible_ssh_common_args: "-o ConnectTimeout=3"
      loop: "{{ cidr_hosts }}"

- hosts: cidr_targets
  gather_facts: no
  tasks:
    - name: Ping subnet
      ping:
