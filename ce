cat Dockerfile
FROM node:18
 
ARG VERSION_VALUE
ARG OUTPUT_DIRECTORY=/output_folder/npm/
 
RUN pwd
# Copy the certificate into the container
COPY /tools/sw/opt/data/dataCenterCerts/stash.calix.local.crt /usr/local/share/ca-certificates/stash.calix.local.crt
 
# Install ca-certificates and register the custom certificate
RUN apt-get update && \
    apt-get install -y ca-certificates && \
    update-ca-certificates
 
WORKDIR /app
RUN npm install -g @angular/cli@16.2.0
 
RUN mkdir -p ${OUTPUT_DIRECTORY}
 
#RUN git config --global http.sslVerify false
 
RUN --mount=type=secret,id=netrc,dst=/root/.netrc git clone -b feature/uxmgr-web-latest https://stash.calix.local/scm/ccs/uxmgr-web.git
 
WORKDIR /app/uxmgr-web
RUN npm cache clean --force
RUN npm cache verify
RUN rm -rf node_modules package-lock.json
# Install application dependencies
RUN --mount=type=secret,id=npmrc,dst=/root/.npmrc npm install -f --scope=@ccsDownload
 
WORKDIR /app/uxmgr-web/projects
COPY . uxmgrshared-library
WORKDIR /app/uxmgr-web/projects/uxmgrshared-library
 
RUN NODE_OPTIONS=--max-old-space-size=6096 ng build
WORKDIR /app/uxmgr-web/dist/uxmgrshared-library
RUN npm version ${VERSION_VALUE}
RUN npm pack
 
RUN cp -f uxmgrshared-library-${VERSION_VALUE}.tgz ${OUTPUT_DIRECTORY}
 
ENTRYPOINT ["echo", "done"]
