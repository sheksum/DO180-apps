# HTTP redirect (optional, like prod)
server {
    listen 80;
    server_name plnx-dev-atlproxy;  # or the box's hostname; optional
    return 301 https://$host$request_uri;
}

# tools-dev → pln-devhoffman:80
server {
    listen 443 ssl;
    server_name tools-dev.calix.com;

    ssl_certificate     /etc/nginx/conf.d/ssl/bamboo_bundle.pem;
    ssl_certificate_key /etc/nginx/conf.d/ssl/bamboo.calix.com.key;
    ssl_protocols TLSv1.2;
    ssl_ciphers  ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers on;
    ssl_session_timeout 5m;

    location / {
        proxy_pass http://pln-devhoffman.calix.local:80;

        # Mirror prod headers (Host remains client host because "Host" is not set)
        proxy_set_header X-Forwarded-Host  $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_redirect off;
        proxy_headers_hash_max_size 512;
        proxy_headers_hash_bucket_size 64;
    }
}


Important differences from your earlier attempts:
Use server_name tools-dev.calix.com.
Do not include include ...whitelist / deny all; for tools-dev (prod doesn’t).
Keep proxy_pass to http://pln-devhoffman:80 (plain HTTP).
It’s fine to keep using the bamboo_bundle.pem cert if tools-dev is in the SAN (you already verified that).
Then:
nginx -t && systemctl reload nginx



2) Dev Hoffman (Apache)
Match prod’s behavior:
Apache listens on 80 and serves the default page for any Host (or add a vhost if you want explicitness).
Minimal requirement (already looks correct from your last screenshots):
/etc/apache2/ports.conf contains:
Listen 80
No special vhost needed for tools-dev; the default *:80 will respond.
(Optional explicit vhost if you prefer):


<VirtualHost *:80>
  ServerName tools-dev.calix.com
  DocumentRoot /var/www/html
  <Location />
    Require all granted
  </Location>
</VirtualHost>




Quick verification checklist (after network rule)
On dev proxy:
time curl -sSI --max-time 5 -H "Host: tools-dev.calix.com" http://pln-devhoffman.calix.local:80/
# should be a fast 200/30x

nginx -t && systemctl reload nginx
curl -Ik https://tools-dev.calix.com/
# expect 200/30x and access.log lines on both proxy and Hoffman

