[root@pln-petipareplica ~]# sed -n '1540,1590p' /etc/dirsrv/slapd-IPA-CALIX-LOCAL/dse.ldif
objectClass: nsSlapdPlugin
objectClass: extensibleObject

dn: cn=PAM Pass Through Auth,cn=plugins,cn=config
cn: PAM Pass Through Auth
nsslapd-plugin-depends-on-type: database
nsslapd-pluginDescription: PAM pass through authentication plugin
nsslapd-pluginEnabled: on
nsslapd-pluginId: pam_passthruauth
nsslapd-pluginInitfunc: pam_passthruauth_init
nsslapd-pluginPath: libpam-passthru-plugin
nsslapd-pluginType: betxnpreoperation
nsslapd-pluginVendor: 389 Project
nsslapd-pluginVersion: 1.4.3.39
nsslapd-pluginloadglobal: true
objectClass: top
objectClass: nsSlapdPlugin
objectClass: extensibleObject
objectClass: pamConfig
pamExcludeSuffix: cn=config
pamFallback: FALSE
pamIDAttr: notUsedWithRDNMethod
pamIDMapMethod: RDN
pamMissingSuffix: ALLOW
pamSecure: TRUE
pamService: ldapserver

dn: cn=Pass Through Authentication,cn=plugins,cn=config
cn: Pass Through Authentication
nsslapd-plugin-depends-on-type: database
nsslapd-pluginDescription: pass through authentication plugin
nsslapd-pluginEnabled: on
nsslapd-pluginId: passthruauth
nsslapd-pluginInitfunc: passthruauth_init
nsslapd-pluginPath: libpassthru-plugin
nsslapd-pluginType: preoperation
nsslapd-pluginVendor: 389 Project
nsslapd-pluginVersion: 1.4.3.39
objectClass: top
objectClass: nsSlapdPlugin
objectClass: extensibleObject

dn: cn=Password Storage Schemes,cn=plugins,cn=config
cn: Password Storage Schemes
objectClass: top
objectClass: nsContainer
numSubordinates: 23

dn: cn=Posix Winsync API,cn=plugins,cn=config
cn: Posix Winsync API
nsslapd-plugin-depends-on-type: database
[root@pln-petipareplica ~]#



sed -i '1087s/nsslapd-pluginEnabled: on/nsslapd-pluginEnabled: off/' /etc/dirsrv/slapd-IPA-CALIX-LOCAL/dse.ldif


sed -n '1086,1092p' /etc/dirsrv/slapd-IPA-CALIX-LOCAL/dse.ldif

ldapadd -x -H ldap://localhost -D "cn=directory manager" -W -f /tmp/cpeg-agreement.ldif


systemctl stop dirsrv@IPA-CALIX-LOCAL
sed -i '1087s/nsslapd-pluginEnabled: off/nsslapd-pluginEnabled: on/' /etc/dirsrv/slapd-IPA-CALIX-LOCAL/dse.ldif
systemctl start dirsrv@IPA-CALIX-LOCAL



sed -i 's/nsslapd-pluginEnabled: off/nsslapd-pluginEnabled: on/' /etc/dirsrv/slapd-IPA-CALIX-LOCAL/dse.ldif



# Stop dirsrv
systemctl stop dirsrv@IPA-CALIX-LOCAL

# Disable the topology plugin in dse.ldif
sed -i 's/nsslapd-pluginEnabled: on/nsslapd-pluginEnabled: off/' /etc/dirsrv/slapd-IPA-CALIX-LOCAL/dse.ldif




cat > /tmp/cpeg-agreement.ldif << 'EOF'
dn: cn=meTocpeg-ipareplica.ipa.calix.local,cn=replica,cn=dc\3Dipa\2Cdc\3Dcalix\2Cdc\3Dlocal,cn=mapping tree,cn=config
objectClass: nsds5replicationagreement
objectClass: top
cn: meTocpeg-ipareplica.ipa.calix.local
nsDS5ReplicaHost: cpeg-ipareplica.ipa.calix.local
nsDS5ReplicaPort: 389
nsds5replicaTimeout: 120
nsDS5ReplicaRoot: dc=ipa,dc=calix,dc=local
description: me to cpeg-ipareplica.ipa.calix.local
nsDS5ReplicatedAttributeList: (objectclass=*) $ EXCLUDE memberof idnssoaserial entryusn krblastsuccessfulauth krblastfailedauth krbloginfailedcount passwordgraceusertime
nsDS5ReplicaTransportInfo: LDAP
nsDS5ReplicaBindMethod: SASL/GSSAPI
nsds5ReplicaStripAttrs: modifiersName modifyTimestamp internalModifiersName internalModifyTimestamp
nsDS5ReplicatedAttributeListTotal: (objectclass=*) $ EXCLUDE entryusn krblastsuccessfulauth krblastfailedauth krbloginfailedcount passwordgraceusertime
nsds5ReplicaEnabled: on
EOF

ldapadd -x -H ldap://localhost -D "cn=directory manager" -W -f /tmp/cpeg-agreement.ldif

ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(objectclass=nsds5replicationagreement)" dn nsds5replicahost nsds5replicaLastUpdateStatus




[root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]# ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(cn=meTopln-petipareplica.ipa.calix.local)" "*"
Enter LDAP Password:
# extended LDIF
#
# LDAPv3
# base <cn=config> with scope subtree
# filter: (cn=meTopln-petipareplica.ipa.calix.local)
# requesting: *
#

# meTopln-petipareplica.ipa.calix.local, replica, dc\3Dipa\2Cdc\3Dcalix\2Cdc\3D
 local, mapping tree, config
dn: cn=meTopln-petipareplica.ipa.calix.local,cn=replica,cn=dc\3Dipa\2Cdc\3Dcal
 ix\2Cdc\3Dlocal,cn=mapping tree,cn=config
objectClass: nsds5replicationagreement
objectClass: top
objectClass: ipaReplTopoManagedAgreement
cn: meTopln-petipareplica.ipa.calix.local
nsDS5ReplicaHost: pln-petipareplica.ipa.calix.local
nsDS5ReplicaPort: 389
nsds5replicaTimeout: 120
nsDS5ReplicaRoot: dc=ipa,dc=calix,dc=local
description: me to pln-petipareplica.ipa.calix.local
nsDS5ReplicatedAttributeList: (objectclass=*) $ EXCLUDE memberof idnssoaserial
  entryusn krblastsuccessfulauth krblastfailedauth krbloginfailedcount passwor
 dgraceusertime
nsDS5ReplicaTransportInfo: LDAP
nsDS5ReplicaBindMethod: SASL/GSSAPI
nsds5ReplicaStripAttrs: modifiersName modifyTimestamp internalModifiersName in
 ternalModifyTimestamp
nsDS5ReplicatedAttributeListTotal: (objectclass=*) $ EXCLUDE entryusn krblasts
 uccessfulauth krblastfailedauth krbloginfailedcount passwordgraceusertime
ipaReplTopoManagedAgreementState: managed agreement - controlled by topology p
 lugin
nsds50ruv: {replicageneration} 66ade489000000140000
nsds50ruv: {replica 33 ldap://pln-petipareplica.ipa.calix.local:389} 699f46f40
 00100210000 699f4c02000100210000
nsds50ruv: {replica 20 ldap://cpeg-ipareplica.ipa.calix.local:389} 66ade48b000
 000140000 ffffffff6f0a00140000
nsds50ruv: {replica 25 ldap://pln-petipareplica.ipa.calix.local:389}
nsds50ruv: {replica 31 ldap://pln-petipareplica.ipa.calix.local:389} 699e3f370
 001001f0000 699f2b7e0006001f0000
nsruvReplicaLastModified: {replica 33 ldap://pln-petipareplica.ipa.calix.local
 :389} 00000000
nsruvReplicaLastModified: {replica 20 ldap://cpeg-ipareplica.ipa.calix.local:3
 89} 00000000
nsruvReplicaLastModified: {replica 25 ldap://pln-petipareplica.ipa.calix.local
 :389} 00000000
nsruvReplicaLastModified: {replica 31 ldap://pln-petipareplica.ipa.calix.local
 :389} 00000000
nsds5ReplicaEnabled: on
nsds5replicareapactive: 0
nsds5replicaLastUpdateStart: 20260225014736Z
nsds5replicaLastUpdateEnd: 20260225014736Z
nsds5replicaChangesSentSinceStartup:: MjA6NDI1LzAg
nsds5replicaLastUpdateStatus: Error (0) Replica acquired successfully: Increme
 ntal update succeeded
nsds5replicaLastUpdateStatusJSON: {"state": "green", "ldap_rc": "0", "ldap_rc_
 text": "Success", "repl_rc": "0", "repl_rc_text": "replica acquired", "date":
  "2026-02-25T01:47:36Z", "message": "Error (0) Replica acquired successfully:
  Incremental update succeeded"}
nsds5replicaUpdateInProgress: FALSE
nsds5replicaLastInitStart: 19700101000000Z
nsds5replicaLastInitEnd: 19700101000000Z

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
[root@cpeg-ipareplica ~]#







ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(cn=meTopln-petipareplica.ipa.calix.local)" "*"

ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(objectclass=nsds5replicationagreement)" dn nsds5replicahost




Master:

[root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]# ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(objectclass=nsds5replicationagreement)" dn nsds5replicahost nsds5replicaLastUpdateStatus
Enter LDAP Password:
# extended LDIF
#
# LDAPv3
# base <cn=config> with scope subtree
# filter: (objectclass=nsds5replicationagreement)
# requesting: dn nsds5replicahost nsds5replicaLastUpdateStatus
#

# cpeg-ipareplica.ipa.calix.local-to-ric-ipareplica01.ipa.calix.local, replica,
  dc\3Dipa\2Cdc\3Dcalix\2Cdc\3Dlocal, mapping tree, config
dn: cn=cpeg-ipareplica.ipa.calix.local-to-ric-ipareplica01.ipa.calix.local,cn=
 replica,cn=dc\3Dipa\2Cdc\3Dcalix\2Cdc\3Dlocal,cn=mapping tree,cn=config
nsds5replicahost: ric-ipareplica01.ipa.calix.local
nsds5replicaLastUpdateStatus: Error (18) Can't acquire replica (Incremental up
 date transient warning.  Backing off, will retry update later.)

# cpeg-ipareplica.ipa.calix.local-to-sjc-ipareplica01.ipa.calix.local, replica,
  dc\3Dipa\2Cdc\3Dcalix\2Cdc\3Dlocal, mapping tree, config
dn: cn=cpeg-ipareplica.ipa.calix.local-to-sjc-ipareplica01.ipa.calix.local,cn=
 replica,cn=dc\3Dipa\2Cdc\3Dcalix\2Cdc\3Dlocal,cn=mapping tree,cn=config
nsds5replicahost: sjc-ipareplica01.ipa.calix.local
nsds5replicaLastUpdateStatus: Error (6) Replication error acquiring replica: U
 nable to acquire replica: there is no replicated area on the consumer server.
  Replication is aborting. (no such replica)

# meTopln-petipareplica.ipa.calix.local, replica, dc\3Dipa\2Cdc\3Dcalix\2Cdc\3D
 local, mapping tree, config
dn: cn=meTopln-petipareplica.ipa.calix.local,cn=replica,cn=dc\3Dipa\2Cdc\3Dcal
 ix\2Cdc\3Dlocal,cn=mapping tree,cn=config
nsds5replicahost: pln-petipareplica.ipa.calix.local
nsds5replicaLastUpdateStatus: Error (0) Replica acquired successfully: Increme
 ntal update succeeded

# caTopln-petipareplica.ipa.calix.local, replica, o\3Dipaca, mapping tree, conf
 ig
dn: cn=caTopln-petipareplica.ipa.calix.local,cn=replica,cn=o\3Dipaca,cn=mappin
 g tree,cn=config
nsds5replicahost: pln-petipareplica.ipa.calix.local
nsds5replicaLastUpdateStatus: Error (6) Replication error acquiring replica: U
 nable to acquire replica: there is no replicated area on the consumer server.
  Replication is aborting. (no such replica)

# search result
search: 2
result: 0 Success

# numResponses: 5
# numEntries: 4
[root@cpeg-ipareplica ~]#
  [root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]# ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"
Enter LDAP Password:
# extended LDIF
#
# LDAPv3
# base <cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local> with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=ca
 lix,dc=local
ipaMaxDomainLevel: 1
ipaMinDomainLevel: 1
ipaReplTopoManagedSuffix: dc=ipa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
objectClass: ipaReplTopoManagedServer
objectClass: ipaSupportedDomainLevelConfig
cn: pln-petipareplica.ipa.calix.local

# KDC, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=KDC,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ip
 a,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
ipaConfigString: startOrder 10
ipaConfigString: configuredService
ipaConfigString: kdcProxyEnabled
ipaConfigString: pkinitEnabled
ipaConfigString: enabledService
cn: KDC

# HTTP, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=HTTP,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=i
 pa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: HTTP
ipaConfigString: startOrder 40
ipaConfigString: enabledService

# OTPD, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=OTPD,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=i
 pa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: OTPD
ipaConfigString: startOrder 80
ipaConfigString: enabledService

# KEYS, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=KEYS,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=i
 pa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: KEYS
ipaConfigString: startOrder 41
ipaConfigString: enabledService

# KPASSWD, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.loca
 l
dn: cn=KPASSWD,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,d
 c=ipa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: KPASSWD
ipaConfigString: startOrder 20
ipaConfigString: enabledService

# search result
search: 2
result: 0 Success

# numResponses: 7
# numEntries: 6
[root@cpeg-ipareplica ~]#
    [root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]#
[root@cpeg-ipareplica ~]# ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=ipaReplTopoSegment)" dn
Enter LDAP Password:
# extended LDIF
#
# LDAPv3
# base <cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local> with scope subtree
# filter: (objectclass=ipaReplTopoSegment)
# requesting: dn
#

# ric-ipareplica01.ipa.calix.local-to-ric-ipareplica.ipa.calix.local, domain, t
 opology, ipa, etc, ipa.calix.local
dn: cn=ric-ipareplica01.ipa.calix.local-to-ric-ipareplica.ipa.calix.local,cn=d
 omain,cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local

# sjc-ipareplica01.ipa.calix.local-to-nan-ipareplica01.ipa.calix.local, domain,
  topology, ipa, etc, ipa.calix.local
dn: cn=sjc-ipareplica01.ipa.calix.local-to-nan-ipareplica01.ipa.calix.local,cn
 =domain,cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local

# ric-ipareplica01.ipa.calix.local-to-cpeg-ipareplica.ipa.calix.local, domain,
 topology, ipa, etc, ipa.calix.local
dn: cn=ric-ipareplica01.ipa.calix.local-to-cpeg-ipareplica.ipa.calix.local,cn=
 domain,cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local

# pln-petipareplica.ipa.calix.local-to-nan-ipareplica01.ipa.calix.local, domain
 , topology, ipa, etc, ipa.calix.local
dn: cn=pln-petipareplica.ipa.calix.local-to-nan-ipareplica01.ipa.calix.local,c
 n=domain,cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local

# min-ipareplica.ipa.calix.local-to-nan-ipareplica.ipa.calix.local, ca, topolog
 y, ipa, etc, ipa.calix.local
dn: cn=min-ipareplica.ipa.calix.local-to-nan-ipareplica.ipa.calix.local,cn=ca,
 cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local

# sjc-ipareplica01.ipa.calix.local-to-cpeg-ipareplica.ipa.calix.local, domain,
 topology, ipa, etc, ipa.calix.local
dn: cn=sjc-ipareplica01.ipa.calix.local-to-cpeg-ipareplica.ipa.calix.local,cn=
 domain,cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local

# cpeg-ipareplica.ipa.calix.local-to-pln-petipareplica.ipa.calix.local, domain,
  topology, ipa, etc, ipa.calix.local
dn: cn=cpeg-ipareplica.ipa.calix.local-to-pln-petipareplica.ipa.calix.local,cn
 =domain,cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local

# cpeg-ipareplica.ipa.calix.local-to-pln-petipareplica.ipa.calix.local, ca, top
 ology, ipa, etc, ipa.calix.local
dn: cn=cpeg-ipareplica.ipa.calix.local-to-pln-petipareplica.ipa.calix.local,cn
 =ca,cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local

# search result
search: 2
result: 0 Success

# numResponses: 9
# numEntries: 8
[root@cpeg-ipareplica ~]#  ===========  [root@pln-petipareplica ~]#
[root@pln-petipareplica ~]#
[root@pln-petipareplica ~]# ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(objectclass=nsds5replicationagreement)" dn nsds5replicahost nsds5replicaLastUpdateStatus
Enter LDAP Password:
# extended LDIF
#
# LDAPv3
# base <cn=config> with scope subtree
# filter: (objectclass=nsds5replicationagreement)
# requesting: dn nsds5replicahost nsds5replicaLastUpdateStatus
#

# pln-petipareplica.ipa.calix.local-to-nan-ipareplica01.ipa.calix.local, replic
 a, dc\3Dipa\2Cdc\3Dcalix\2Cdc\3Dlocal, mapping tree, config
dn: cn=pln-petipareplica.ipa.calix.local-to-nan-ipareplica01.ipa.calix.local,c
 n=replica,cn=dc\3Dipa\2Cdc\3Dcalix\2Cdc\3Dlocal,cn=mapping tree,cn=config
nsds5replicahost: nan-ipareplica01.ipa.calix.local
nsds5replicaLastUpdateStatus: Error (0) No replication sessions started since
 server startup

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
[root@pln-petipareplica ~]#
[root@pln-petipareplica ~]#
[root@pln-petipareplica ~]# ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"
Enter LDAP Password:
# extended LDIF
#
# LDAPv3
# base <cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local> with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=ca
 lix,dc=local
cn: pln-petipareplica.ipa.calix.local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
objectClass: ipaReplTopoManagedServer
objectClass: ipaSupportedDomainLevelConfig
ipaReplTopoManagedSuffix: dc=ipa,dc=calix,dc=local
ipaMinDomainLevel: 1
ipaMaxDomainLevel: 1

# KDC, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=KDC,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ip
 a,dc=calix,dc=local
cn: KDC
ipaConfigString: startOrder 10
ipaConfigString: configuredService
ipaConfigString: kdcProxyEnabled
ipaConfigString: pkinitEnabled
ipaConfigString: enabledService
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top

# HTTP, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=HTTP,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=i
 pa,dc=calix,dc=local
ipaConfigString: startOrder 40
ipaConfigString: enabledService
cn: HTTP
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top

# OTPD, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=OTPD,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=i
 pa,dc=calix,dc=local
ipaConfigString: startOrder 80
ipaConfigString: enabledService
cn: OTPD
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top

# KEYS, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.local
dn: cn=KEYS,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=i
 pa,dc=calix,dc=local
ipaConfigString: startOrder 41
ipaConfigString: enabledService
cn: KEYS
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top

# KPASSWD, pln-petipareplica.ipa.calix.local, masters, ipa, etc, ipa.calix.loca
 l
dn: cn=KPASSWD,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,d
 c=ipa,dc=calix,dc=local
ipaConfigString: startOrder 20
ipaConfigString: enabledService
cn: KPASSWD
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top

# search result
search: 2
result: 0 Success

# numResponses: 7
# numEntries: 6
[root@pln-petipareplica ~]#




# All replication agreements
ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(objectclass=nsds5replicationagreement)" dn nsds5replicahost nsds5replicaLastUpdateStatus

# Server entry for pln
ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"

# Topology segments
ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=topology,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=ipaReplTopoSegment)" dn



# All replication agreements
ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(objectclass=nsds5replicationagreement)" dn nsds5replicahost nsds5replicaLastUpdateStatus

# Server entry for pln
ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"




ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=ipaReplTopoSegment)" dn




cat > /tmp/topo-segment.ldif << 'EOF'
dn: cn=cpeg-to-pln,cn=domain,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local
objectClass: ipaReplTopoSegment
objectClass: top
cn: cpeg-to-pln
ipaReplTopoSegmentDirection: both
ipaReplTopoSegmentLeftNode: cpeg-ipareplica.ipa.calix.local
ipaReplTopoSegmentRightNode: pln-petipareplica.ipa.calix.local
EOF

ldapadd -x -H ldap://localhost -D "cn=directory manager" -W -f /tmp/topo-segment.ldif



ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=cpeg-ipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" -s base "(objectclass=*)" ipaReplTopoManagedSuffix



ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" -s base "(objectclass=*)" ipaReplTopoManagedSuffix


ldapsearch -Y GSSAPI -H ldap://pln-petipareplica.ipa.calix.local -b "" -s base



kinit -k -t /etc/dirsrv/ds.keytab ldap/cpeg-ipareplica.ipa.calix.local
klist



ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(nsds5replicahost=pln-petipareplica.ipa.calix.local)" nsds5ReplicaBindMethod nsds5ReplicaTransportInfo nsds5replicaport


klist -kt /etc/dirsrv/ds.keytab


kinit -k -t /etc/dirsrv/ds.keytab ldap/pln-petipareplica.ipa.calix.local


cat > /tmp/pln-services.ldif << 'EOF'
dn: cn=HTTP,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: HTTP
ipaConfigString: startOrder 40
ipaConfigString: enabledService

dn: cn=OTPD,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: OTPD
ipaConfigString: startOrder 80
ipaConfigString: enabledService

dn: cn=KEYS,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: KEYS
ipaConfigString: startOrder 41
ipaConfigString: enabledService
EOF

ldapadd -x -H ldap://localhost -D "cn=directory manager" -W -f /tmp/pln-services.ldif


cat > /tmp/pln-kpasswd.ldif << 'EOF'
dn: cn=KPASSWD,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: KPASSWD
ipaConfigString: startOrder 20
ipaConfigString: enabledService
EOF

ldapadd -x -H ldap://localhost -D "cn=directory manager" -W -f /tmp/pln-kpasswd.ldif


cat > /tmp/pln-update.ldif << 'EOF'
dn: cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local
changetype: modify
add: objectClass
objectClass: ipaReplTopoManagedServer
objectClass: ipaSupportedDomainLevelConfig
-
add: ipaReplTopoManagedSuffix
ipaReplTopoManagedSuffix: dc=ipa,dc=calix,dc=local
-
add: ipaMinDomainLevel
ipaMinDomainLevel: 1
-
add: ipaMaxDomainLevel
ipaMaxDomainLevel: 1
EOF

ldapmodify -x -H ldap://localhost -D "cn=directory manager" -W -f /tmp/pln-update.ldif

ipa server-role-find --server=pln-petipareplica.ipa.calix.local

ipa topologysegment-add domain --left=cpeg-ipareplica.ipa.calix.local --right=pln-petipareplica.ipa.calix.local








ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"






ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"


ipa topologysegment-add domain --left=cpeg-ipareplica.ipa.calix.local --right=pln-petipareplica.ipa.calix.local --name=cpeg-to-pln



ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(nsds5replicahost=pln-petipareplica.ipa.calix.local)" nsds5ReplicaTransportInfo nsds5replicaport




ldapdelete -x -H ldap://localhost -D "cn=directory manager" -W "cn=KDC,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local"
ldapdelete -x -H ldap://localhost -D "cn=directory manager" -W "cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local"


ipa server-del pln-petipareplica.ipa.calix.local --force


# Verify these still exist
ipa host-show pln-petipareplica.ipa.calix.local
ipa service-show HTTP/pln-petipareplica.ipa.calix.local


ipa-server-install --uninstall --ignore-topology-disconnect
ipa-replica-install --principal admin --admin-password '<password>' --setup-ca --domain ipa.calix.local --server cpeg-ipareplica.ipa.calix.local --realm IPA.CALIX.LOCAL --force-join




ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=KDC,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"


cat > /tmp/pln-kdc.ldif << 'EOF'
dn: cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
cn: pln-petipareplica.ipa.calix.local

dn: cn=KDC,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local
objectClass: nsContainer
objectClass: ipaConfigObject
objectClass: top
ipaConfigString: startOrder 10
ipaConfigString: configuredService
ipaConfigString: kdcProxyEnabled
ipaConfigString: pkinitEnabled
ipaConfigString: enabledService
cn: KDC
EOF

ldapadd -x -H ldap://localhost -D "cn=directory manager" -W -f /tmp/pln-kdc.ldif




# Check if the KDC entry exists on the master now
ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=KDC,cn=pln-petipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"


ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=KDC,cn=cpeg-ipareplica.ipa.calix.local,cn=masters,cn=ipa,cn=etc,dc=ipa,dc=calix,dc=local" "(objectclass=*)"


ldapsearch -x -H ldap://localhost -D "cn=directory manager" -W -b "cn=config" "(objectclass=nsds5replicationagreement)" nsds5replicahost nsds5replicaLastUpdateStatus



ldapsearch -x -H ldap://cpeg-ipareplica.ipa.calix.local -D "cn=directory manager" -W -b "cn=config" "(objectclass=nsds5replicationagreement)" nsds5replicahost nsds5replicaLastUpdateStatus
