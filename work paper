hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc describe secretstore vault-store -n pai-dev | tail -20
      Auth:
        Kubernetes:
          Mount Path:  kubernetes-ocp-ai
          Role:        eso-pai-dev
          Service Account Ref:
            Name:  external-secrets
      Path:        kv
      Server:      https://plnx-vault.calix.local:8200
      Version:     v2
Status:
  Conditions:
    Last Transition Time:  2026-02-26T06:37:45Z
    Message:               unable to create client
    Reason:                InvalidProviderConfig
    Status:                False
    Type:                  Ready
Events:
  Type     Reason                 Age   From          Message
  ----     ------                 ----  ----          -------
  Warning  InvalidProviderConfig  109s  secret-store  unable to log in to auth method: unable to log in with Kubernetes auth: context deadline exceeded
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc describe secretstore vault-store -n trident | tail -10
  Conditions:
    Last Transition Time:  2026-02-26T06:36:45Z
    Message:               unable to create client
    Reason:                InvalidProviderConfig
    Status:                False
    Type:                  Ready
Events:
  Type     Reason                 Age                  From          Message
  ----     ------                 ----                 ----          -------
  Warning  InvalidProviderConfig  96s (x2 over 4m36s)  secret-store  cannot request Kubernetes service account token for service account "external-secrets": cannot get Kubernetes service account "external-secrets": ServiceAccount "external-secrets" not found
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get pods -n external-secrets -o wide
NAME                                                READY   STATUS    RESTARTS   AGE     IP             NODE                          NOMINATED NODE   READINESS GATES
external-secrets-56f4bc8b5-z28x2                    1/1     Running   0          5m49s   10.129.0.158   ocp-ai-master01.calix.local   <none>           <none>
external-secrets-cert-controller-6db84767c6-wn7fc   1/1     Running   0          5m49s   10.128.0.200   ocp-ai-master02.calix.local   <none>           <none>
external-secrets-webhook-946c4fdd4-zjw59            1/1     Running   0          5m49s   10.129.0.157   ocp-ai-master01.calix.local   <none>           <none>
hsuma@plnx-admin:~/ocp-ai-config$ oc get secretstore vault-store -n trident -o yaml | grep -A5 caBundle
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get secretstore vault-store -n trident -o yaml | grep -A5 caProvider
hsuma@plnx-admin:~/ocp-ai-config$



oc describe secretstore vault-store -n trident | tail -10

oc get pods -n external-secrets -o wide


oc get secretstore vault-store -n trident -o yaml | grep -A5 caBundle


oc get secretstore vault-store -n trident -o yaml | grep -A5 caProvider

hsuma@plnx-admin:~/ocp-ai-config$


hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc describe secretstore vault-store -n pai-dev | tail -20
      Auth:
        Kubernetes:
          Mount Path:  kubernetes-ocp-ai
          Role:        eso-pai-dev
          Service Account Ref:
            Name:  external-secrets
      Path:        kv
      Server:      https://plnx-vault.calix.local:8200
      Version:     v2
Status:
  Conditions:
    Last Transition Time:  2026-02-26T06:37:45Z
    Message:               unable to create client
    Reason:                InvalidProviderConfig
    Status:                False
    Type:                  Ready
Events:
  Type     Reason                 Age   From          Message
  ----     ------                 ----  ----          -------
  Warning  InvalidProviderConfig  109s  secret-store  unable to log in to auth method: unable to log in with Kubernetes auth: context deadline exceeded
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc describe externalsecret test-secret -n pai-dev | tail -20
    Kind:  SecretStore
    Name:  vault-store
  Target:
    Creation Policy:  Owner
    Deletion Policy:  Retain
    Name:             test-secret
Status:
  Binding:
    Name:
  Conditions:
    Last Transition Time:  2026-02-26T06:35:45Z
    Message:               could not get secret data from provider
    Reason:                SecretSyncedError
    Status:                False
    Type:                  Ready
  Refresh Time:            <nil>
Events:
  Type     Reason        Age                  From              Message
  ----     ------        ----                 ----              -------
  Warning  UpdateFailed  50s (x8 over 2m55s)  external-secrets  error processing spec.data[0] (key: pai/dev/test-secret), err: SecretStore "vault-store" is not ready
hsuma@plnx-admin:~/ocp-ai-config$


oc apply -f - <<EOF
apiVersion: operator.openshift.io/v1alpha1
kind: ExternalSecretsConfig
metadata:
  name: cluster
spec:
  managementState: Managed
EOF



hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get externalsecret -n trident
NAME                   STORETYPE     STORE         REFRESH INTERVAL   STATUS   READY
backend-app-secret     SecretStore   vault-store   1h
backend-infra-secret   SecretStore   vault-store   1h
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc describe  externalsecret -n trident
Name:         backend-app-secret
Namespace:    trident
Labels:       <none>
Annotations:  <none>
API Version:  external-secrets.io/v1
Kind:         ExternalSecret
Metadata:
  Creation Timestamp:  2026-02-24T00:39:17Z
  Generation:          1
  Resource Version:    3424900
  UID:                 39e72b19-af86-46a8-bfdf-f3535c9b90b1
Spec:
  Data:
    Remote Ref:
      Conversion Strategy:  Default
      Decoding Strategy:    None
      Key:                  trident/app
      Metadata Policy:      None
      Property:             username
    Secret Key:             username
    Remote Ref:
      Conversion Strategy:  Default
      Decoding Strategy:    None
      Key:                  trident/app
      Metadata Policy:      None
      Property:             password
    Secret Key:             password
  Refresh Interval:         1h
  Secret Store Ref:
    Kind:  SecretStore
    Name:  vault-store
  Target:
    Creation Policy:  Owner
    Deletion Policy:  Retain
    Name:             backend-app-secret
Events:               <none>


Name:         backend-infra-secret
Namespace:    trident
Labels:       <none>
Annotations:  <none>
API Version:  external-secrets.io/v1
Kind:         ExternalSecret
Metadata:
  Creation Timestamp:  2026-02-24T00:38:56Z
  Generation:          1
  Resource Version:    3424777
  UID:                 42762893-2fcc-4f01-a32f-99ccf34060cb
Spec:
  Data:
    Remote Ref:
      Conversion Strategy:  Default
      Decoding Strategy:    None
      Key:                  trident/infra
      Metadata Policy:      None
      Property:             username
    Secret Key:             username
    Remote Ref:
      Conversion Strategy:  Default
      Decoding Strategy:    None
      Key:                  trident/infra
      Metadata Policy:      None
      Property:             password
    Secret Key:             password
  Refresh Interval:         1h
  Secret Store Ref:
    Kind:  SecretStore
    Name:  vault-store
  Target:
    Creation Policy:  Owner
    Deletion Policy:  Retain
    Name:             backend-infra-secret
Events:               <none>
hsuma@plnx-admin:~/ocp-ai-config$ oc get secrets -n trident
NAME                                 TYPE                      DATA   AGE
backend-app-secret                   Opaque                    2      8d
backend-infra-secret                 Opaque                    2      8d
builder-dockercfg-9dn8h              kubernetes.io/dockercfg   1      7d11h
default-dockercfg-bdwm2              kubernetes.io/dockercfg   1      7d11h
deployer-dockercfg-vqr6s             kubernetes.io/dockercfg   1      7d11h
trident-controller-dockercfg-t4s2g   kubernetes.io/dockercfg   1      7d11h
trident-csi                          Opaque                    6      8d
trident-encryption-keys              Opaque                    1      8d
trident-node-linux-dockercfg-rwf8z   kubernetes.io/dockercfg   1      7d11h
trident-operator-dockercfg-5kpmc     kubernetes.io/dockercfg   1      7d11h
hsuma@plnx-admin:~/ocp-ai-config$


hsuma@plnx-admin:~/ocp-ai-config$ oc get operatorconfig -A -o yaml 2>/dev/null || oc get deployment external-secrets-operator-controller-manager -n external-secrets-operator -o yaml | grep -A5 -i namespace
    olm.owner.namespace: external-secrets-operator
    operators.coreos.com/openshift-external-secrets-operator.external-secrets-operator: ""
  name: external-secrets-operator-controller-manager
  namespace: external-secrets-operator
  ownerReferences:
  - apiVersion: operators.coreos.com/v1alpha1
    blockOwnerDeletion: false
    controller: false
    kind: ClusterServiceVersion
--
                "namespaceSelector": {
                  "matchLabels": {
                    "app.kubernetes.io/managed-by": "external-secrets-operator"
                  }
                }
              }
--
                          "namespace": "external-secrets"
                        }
                      }
                    },
                    "projectID": "openshift-sample-project"
                  }
--
                "namespace": "external-secrets"
              },
              "spec": {
                "data": [
                  {
                    "remoteRef": {
--
                "namespace": "external-secrets"
              },
              "spec": {
                "provider": {
                  "gcpsm": {
                    "auth": {
--
                "namespace": "external-secrets"
              },
              "spec": {
                "config": {
                  "gcp": {
                    "projectID": "openshift-sample-project",
--
                "namespace": "external-secrets"
              },
              "spec": {
                "excludeLowercase": false,
                "excludeNumbers": false,
                "excludeUppercase": false,
--
        olm.operatorNamespace: external-secrets-operator
        olm.skipRange: <1.0.0
        olm.targetNamespaces: ""
        operator.openshift.io/uninstall-message: The External Secrets Operator for
          Red Hat OpenShift will be removed from external-secrets-operator namespace.
          If your Operator configured any off-cluster resources, these will continue
          to run and require manual cleanup. All operands created by the operator
          will need to be manually cleaned up. Please refer to https://docs.openshift.com/container-platform/latest/security/external_secrets_operator/external-secrets-operator-uninstall.html
          for additional steps.
        operatorframework.io/cluster-monitoring: "true"
--
        operatorframework.io/suggested-namespace: external-secrets-operator
        operators.openshift.io/valid-subscription: '["OpenShift Kubernetes Engine",
          "OpenShift Container Platform", "OpenShift Platform Plus"]'
        operators.operatorframework.io/builder: operator-sdk-v1.39.0
        operators.operatorframework.io/project_layout: go.kubebuilder.io/v4
        repository: https://github.com/openshift/external-secrets-operator
--
        - name: WATCH_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.annotations['olm.targetNamespaces']
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get csv -n external-secrets-operator | grep external
external-secrets-operator.v1.0.0        External Secrets Operator for Red Hat OpenShift   1.0.0                                                     Succeeded
hsuma@plnx-admin:~/ocp-ai-config$ oc get deployment external-secrets-operator-controller-manager -n external-secrets-operator -o yaml | grep -A20 env
        env:
        - name: WATCH_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.annotations['olm.targetNamespaces']
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: OPERATOR_LOG_LEVEL
          value: "2"
        - name: OPERATOR_NAME
          value: external-secrets-operator
        - name: OPERATOR_IMAGE_VERSION
          value: 1.0.0
        - name: RELATED_IMAGE_EXTERNAL_SECRETS
          value: registry.redhat.io/external-secrets-operator/external-secrets-rhel9@sha256:a594323b4d3ad6a739246f3767231ad2d57ca94bb1d035610d52a525b420b452
        - name: OPERAND_EXTERNAL_SECRETS_IMAGE_VERSION
          value: 0.19.0
hsuma@plnx-admin:~/ocp-ai-config$
oc get operatorconfig -A -o yaml 2>/dev/null || oc get deployment external-secrets-operator-controller-manager -n external-secrets-operator -o yaml | grep -A5 -i namespace


oc get csv -n external-secrets-operator | grep external


oc get deployment external-secrets-operator-controller-manager -n external-secrets-operator -o yaml | grep -A20 env

NAME                                                            READY   STATUS    RESTARTS       AGE
external-secrets-operator-controller-manager-6d5f5b7474-k7flj   1/1     Running   1 (2d2h ago)   2d10h
hsuma@plnx-admin:~/ocp-ai-config$ oc logs external-secrets-operator-controller-manager-6d5f5b7474-k7flj -n external-secrets-operator | grep -i pai
I0224 03:28:15.946126       1 main.go:154] "using certificate key pair found in the configured dir for metrics server" logger="setup"
hsuma@plnx-admin:~/ocp-ai-config$ oc logs external-secrets-operator-controller-manager-6d5f5b7474-k7flj -n external-secrets-operator | grep -i pai-dev
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc describe secretstore vault-store -n pai-dev | tail -20
API Version:  external-secrets.io/v1
Kind:         SecretStore
Metadata:
  Creation Timestamp:  2026-02-26T06:10:23Z
  Generation:          1
  Resource Version:    4629680
  UID:                 feb65599-ef85-46ed-9989-371f8d1e7409
Spec:
  Provider:
    Vault:
      Auth:
        Kubernetes:
          Mount Path:  kubernetes-ocp-ai
          Role:        eso-pai-dev
          Service Account Ref:
            Name:  external-secrets
      Path:        kv
      Server:      https://plnx-vault.calix.local:8200
      Version:     v2
Events:            <none>
hsuma@plnx-admin:~/ocp-ai-config$


oc get externalsecret test-secret -n pai-dev
oc get secret test-secret -n pai-dev -o jsonpath='{.data.username}' | base64 -d



hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get secretstores -A
NAMESPACE   NAME          AGE    STATUS   CAPABILITIES   READY
pai-dev     vault-store   18s
pai-prod    vault-store   18s
pai-test    vault-store   18s
trident     vault-store   2d5h
hsuma@plnx-admin:~/ocp-ai-config$ oc apply -f - <<EOF
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: test-secret
  namespace: pai-dev
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: vault-store
    kind: SecretStore
  target:
    name: test-secret
  data:
    - secretKey: username
      remoteRef:
        key: pai/dev/test-secret
        property: username
    - secretKey: password
      remoteRef:
        key: pai/dev/test-secret
        property: password
EOF
externalsecret.external-secrets.io/test-secret created
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get externalsecret test-secret -n pai-dev
NAME          STORETYPE     STORE         REFRESH INTERVAL   STATUS   READY
test-secret   SecretStore   vault-store   1m
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get secret test-secret -n pai-dev -o jsonpath='{.data.username}' | base64 -d
Error from server (NotFound): secrets "test-secret" not found
hsuma@plnx-admin:~/ocp-ai-config$ oc get secret test-secret -n pai-dev -o jsonpath='{.data.username}' | base64 -d
Error from server (NotFound): secrets "test-secret" not found
hsuma@plnx-admin:~/ocp-ai-config$ oc get externalsecret test-secret -n pai-dev
NAME          STORETYPE     STORE         REFRESH INTERVAL   STATUS   READY
test-secret   SecretStore   vault-store   1m


oc apply -f - <<EOF
# Service accounts
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: external-secrets
  namespace: pai-dev
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: external-secrets
  namespace: pai-test
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: external-secrets
  namespace: pai-prod
# SecretStores
---
apiVersion: external-secrets.io/v1
kind: SecretStore
metadata:
  name: vault-store
  namespace: pai-dev
spec:
  provider:
    vault:
      server: https://plnx-vault.calix.local:8200
      path: kv
      version: v2
      auth:
        kubernetes:
          mountPath: kubernetes-ocp-ai
          role: eso-pai-dev
          serviceAccountRef:
            name: external-secrets
---
apiVersion: external-secrets.io/v1
kind: SecretStore
metadata:
  name: vault-store
  namespace: pai-test
spec:
  provider:
    vault:
      server: https://plnx-vault.calix.local:8200
      path: kv
      version: v2
      auth:
        kubernetes:
          mountPath: kubernetes-ocp-ai
          role: eso-pai-test
          serviceAccountRef:
            name: external-secrets
---
apiVersion: external-secrets.io/v1
kind: SecretStore
metadata:
  name: vault-store
  namespace: pai-prod
spec:
  provider:
    vault:
      server: https://plnx-vault.calix.local:8200
      path: kv
      version: v2
      auth:
        kubernetes:
          mountPath: kubernetes-ocp-ai
          role: eso-pai-prod
          serviceAccountRef:
            name: external-secrets
EOF





hsuma@plnx-admin:~/ocp-ai-config$ oc get secretstore vault-store -n trident -o yaml
apiVersion: external-secrets.io/v1
kind: SecretStore
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"external-secrets.io/v1","kind":"SecretStore","metadata":{"annotations":{},"name":"vault-store","namespace":"trident"},"spec":{"provider":{"vault":{"auth":{"kubernetes":{"mountPath":"kubernetes-ocp-ai","role":"eso-trident","serviceAccountRef":{"name":"external-secrets"}}},"path":"kv","server":"https://plnx-vault.calix.local:8200","version":"v2"}}}}
  creationTimestamp: "2026-02-24T00:38:44Z"
  generation: 1
  name: vault-store
  namespace: trident
  resourceVersion: "3424705"
  uid: 0d7fff1f-b64d-49da-9899-c9f727d20441
spec:
  provider:
    vault:
      auth:
        kubernetes:
          mountPath: kubernetes-ocp-ai
          role: eso-trident
          serviceAccountRef:
            name: external-secrets
      path: kv
      server: https://plnx-vault.calix.local:8200
      version: v2
hsuma@plnx-admin:~/ocp-ai-config$





# pai-dev policy
vault policy write eso-pai-dev - <<EOF
path "kv/data/pai/dev/*" {
  capabilities = ["read"]
}
path "kv/metadata/pai/dev/*" {
  capabilities = ["read", "list"]
}
EOF

# pai-test policy
vault policy write eso-pai-test - <<EOF
path "kv/data/pai/test/*" {
  capabilities = ["read"]
}
path "kv/metadata/pai/test/*" {
  capabilities = ["read", "list"]
}
EOF

# pai-prod policy
vault policy write eso-pai-prod - <<EOF
path "kv/data/pai/prod/*" {
  capabilities = ["read"]
}
path "kv/metadata/pai/prod/*" {
  capabilities = ["read", "list"]
}
EOF




vault write auth/kubernetes-ocp-ai/role/eso-pai-dev \
  bound_service_account_names=external-secrets \
  bound_service_account_namespaces=pai-dev \
  policies=eso-pai-dev \
  ttl=1h

vault write auth/kubernetes-ocp-ai/role/eso-pai-test \
  bound_service_account_names=external-secrets \
  bound_service_account_namespaces=pai-test \
  policies=eso-pai-test \
  ttl=1h

vault write auth/kubernetes-ocp-ai/role/eso-pai-prod \
  bound_service_account_names=external-secrets \
  bound_service_account_namespaces=pai-prod \
  policies=eso-pai-prod \
  ttl=1h



apiVersion: gateway.networking.k8s.io/v1
kind: GatewayClass
metadata:
  name: openshift-default
spec:
  controllerName: openshift.io/gateway-controller/v1


apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: pai-gateway
  namespace: openshift-ingress
spec:
  gatewayClassName: openshift-default
  listeners:
    - name: http
      port: 80
      protocol: HTTP
      allowedRoutes:
        namespaces:
          from: Selector
          selector:
            matchLabels:
              app.kubernetes.io/part-of: pai



apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: gateway-api
  namespace: openshift-gitops
spec:
  project: default
  source:
    repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
    targetRevision: main
    path: gateway-api
  destination:
    server: https://kubernetes.default.svc
    namespace: openshift-ingress
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
```

Commit and push:
```
cd ~/ocp-ai-config
git add gateway-api/ apps/gateway-api-app.yaml
git commit -m "Task 6: Gateway API - GatewayClass and pai-gateway for HTTPRoutes"
git push origin main
```

Then verify ArgoCD picks it up:
```
oc get application -n openshift-gitops



oc debug node/ocp-ai-master01.calix.local -- chroot /host curl -s -o /dev/null -w "%{http_code}" -H "Host: httpbin-dev.apps.ocp-ai.calix.local" http://10.172.248.175




cd ~/ocp-ai-config

cat > metallb/l2advertisement.yaml <<EOF
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: l2-vlan1510
  namespace: metallb-system
spec:
  ipAddressPools:
    - pai-services-dev
    - pai-services-test
    - pai-services-prod
    - reserved-future
EOF

git add metallb/l2advertisement.yaml
git commit -m "Task 6: Add reserved-future pool to L2 advertisement for Gateway API"
git push origin main


hsuma@plnx-admin:~/ocp-ai-config/apps$ oc debug node/ocp-ai-master01.calix.local -- chroot /host curl -s -o /dev/null -w "%{http_code}" -H "Host: httpbin-dev.apps.ocp-ai.calix.local" http://10.172.248.175
Starting pod/ocp-ai-master01calixlocal-debug-79bm7 ...
To use host binaries, run `chroot /host`. Instead, if you need to access host namespaces, run `nsenter -a -t 1`.
403
Removing debug pod ...
hsuma@plnx-admin:~/ocp-ai-config/apps$ sudo arping -c 3 -I ens33 10.172.248.175
ARPING 10.172.248.175
Timeout
Timeout
Timeout


hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ sudo arping -c 3 -I ens33 10.172.248.175
ARPING 10.172.248.175
Timeout
Timeout
Timeout

--- 10.172.248.175 statistics ---
3 packets transmitted, 0 packets received, 100% unanswered (0 extra)

hsuma@plnx-admin:~/ocp-ai-config/apps$ oc debug node/ocp-ai-master01.calix.local -- chroot /host curl -s -o /dev/null -w "%{http_code}" -H "Host: httpbin-dev.apps.ocp-ai.calix.local" http://10.172.248.175
Starting pod/ocp-ai-master01calixlocal-debug-lpwhk ...
To use host binaries, run `chroot /host`. Instead, if you need to access host namespaces, run `nsenter -a -t 1`.
403
Removing debug pod ...
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc logs -l component=speaker -n metallb-system --tail=10 | grep -i 175
Defaulted container "speaker" out of: speaker, kube-rbac-proxy
Defaulted container "speaker" out of: speaker, kube-rbac-proxy
Defaulted container "speaker" out of: speaker, kube-rbac-proxy
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc logs -l component=speaker -n metallb-system -c speaker --tail=10 | grep -i 175
hsuma@plnx-admin:~/ocp-ai-config/apps$


oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: l2-vlan1510
  namespace: metallb-system
spec:
  ipAddressPools:
    - pai-services-dev
    - pai-services-test
    - pai-services-prod
    - reserved-future
EOF

--- 10.172.248.175 statistics ---
3 packets transmitted, 0 packets received, 100% unanswered (0 extra)

hsuma@plnx-admin:~/ocp-ai-config/apps$

oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: MetalLB
metadata:
  name: metallb
  namespace: metallb-system
spec:
  logLevel: warn
EOF

oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: ai-services-dev
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.160-10.172.248.163
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: ai-services-test
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.165-10.172.248.168
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: ai-services-prod
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.170-10.172.248.173
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: reserved-future
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.175-10.172.248.180
  autoAssign: false
EOF



ipaddresspool.metallb.io/ai-services-dev created
ipaddresspool.metallb.io/ai-services-test created
ipaddresspool.metallb.io/ai-services-prod created
ipaddresspool.metallb.io/reserved-future created



oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: l2-vlan1510
  namespace: metallb-system
spec:
  ipAddressPools:
    - ai-services-dev
    - ai-services-test
    - ai-services-prod
EOF




oc apply -f - <<EOF
apiVersion: v1
kind: Namespace
metadata:
  name: pai-dev
  labels:
    env: dev
    app.kubernetes.io/part-of: pai
---
apiVersion: v1
kind: Namespace
metadata:
  name: pai-test
  labels:
    env: test
    app.kubernetes.io/part-of: pai
---
apiVersion: v1
kind: Namespace
metadata:
  name: pai-prod
  labels:
    env: prod
    app.kubernetes.io/part-of: pai
EOF



oc apply -f - <<EOF
apiVersion: v1
kind: Service
metadata:
  name: nginx-test-lb
  namespace: pai-dev
  annotations:
    metallb.universe.tf/address-pool: ai-services-dev
    metallb.universe.tf/loadBalancerIPs: "10.172.248.160"
spec:
  type: LoadBalancer
  loadBalancerIP: "10.172.248.160"
  ports:
    - port: 80
      targetPort: 8080
  selector:
    app: nginx-test
EOF



NAME            TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
nginx-test-lb   LoadBalancer   172.30.37.234   <pending>     80:30808/TCP   45s
hsuma@plnx-admin:~$
hsuma@plnx-admin:~$
hsuma@plnx-admin:~$ oc describe svc nginx-test-lb -n pai-dev | tail -20
Annotations:              metallb.universe.tf/address-pool: ai-services-dev
                          metallb.universe.tf/loadBalancerIPs: 10.172.248.160
Selector:                 app=nginx-test
Type:                     LoadBalancer
IP Family Policy:         SingleStack
IP Families:              IPv4
IP:                       172.30.37.234
IPs:                      172.30.37.234
Desired LoadBalancer IP:  10.172.248.160
Port:                     <unset>  80/TCP
TargetPort:               8080/TCP
NodePort:                 <unset>  30808/TCP
Endpoints:                10.129.0.154:8080
Session Affinity:         None
External Traffic Policy:  Cluster
Internal Traffic Policy:  Cluster
Events:
  Type     Reason            Age   From                Message
  ----     ------            ----  ----                -------
  Warning  AllocationFailed  72s   metallb-controller  Failed to allocate IP for "pai-dev/nginx-test-lb": service can not have both metallb.io/loadBalancerIPs and svc.Spec.LoadBalancerIP
hsuma@plnx-admin:~$



oc delete svc nginx-test-lb -n pai-dev

oc apply -f - <<EOF
apiVersion: v1
kind: Service
metadata:
  name: nginx-test-lb
  namespace: pai-dev
  annotations:
    metallb.universe.tf/address-pool: ai-services-dev
    metallb.universe.tf/loadBalancerIPs: "10.172.248.160"
spec:
  type: LoadBalancer
  ports:
    - port: 80
      targetPort: 8080
  selector:
    app: nginx-test
EOF


# Check which speaker owns the VIP
oc logs -l component=speaker -n metallb-system --tail=10

# Check if the endpoint is healthy
oc get endpoints nginx-test-lb -n pai-dev

# Try from a node directly
oc debug node/ocp-ai-master01.calix.local -- curl -s -o /dev/null -w "%{http_code}" http://10.172.248.160
=======


apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: pai-services-dev
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.160-10.172.248.163
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: pai-services-test
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.165-10.172.248.168
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: pai-services-prod
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.170-10.172.248.173
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: reserved-future
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.175-10.172.248.180
  autoAssign: false






apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: l2-vlan1510
  namespace: metallb-system
spec:
  ipAddressPools:
    - pai-services-dev
    - pai-services-test
    - pai-services-prod


apiVersion: v1
kind: Namespace
metadata:
  name: pai-dev
  labels:
    env: dev
    app.kubernetes.io/part-of: pai
---
apiVersion: v1
kind: Namespace
metadata:
  name: pai-test
  labels:
    env: test
    app.kubernetes.io/part-of: pai
---
apiVersion: v1
kind: Namespace
metadata:
  name: pai-prod
  labels:
    env: prod
    app.kubernetes.io/part-of: pai



apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: metallb
  namespace: openshift-gitops
  labels:
    app.kubernetes.io/part-of: ocp-ai-platform
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
    targetRevision: main
    path: ocp-ai-config/metallb
  destination:
    server: https://kubernetes.default.svc
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m
```

Create those files, then:
```
cd ~/ocp-ai-platform
git add ocp-ai-config/metallb/
git commit -m "Task 6: MetalLB instance, IP pools, L2 advertisement, PAI namespaces"
git push origin main
```

Then apply the ArgoCD app:
```
oc apply -f ocp-ai-config/metallb/argocd-app-metallb.yaml

oc delete ipaddresspool ai-services-dev ai-services-test ai-services-prod reserved-future -n metallb-system

oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: pai-services-dev
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.160-10.172.248.163
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: pai-services-test
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.165-10.172.248.168
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: pai-services-prod
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.170-10.172.248.173
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: reserved-future
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.175-10.172.248.180
  autoAssign: false
EOF


oc delete l2advertisement l2-vlan1510 -n metallb-system

oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: l2-vlan1510
  namespace: metallb-system
spec:
  ipAddressPools:
    - pai-services-dev
    - pai-services-test
    - pai-services-prod
EOF


hsuma@plnx-admin:~/ocp-ai-config$
oc apply -f metallb/argocd-app-metallb.yaml
Warning: metadata.finalizers: "resources-finalizer.argocd.argoproj.io": prefer a domain-qualified finalizer name including a path (/) to avoid accidental conflicts with other finalizer writers
application.argoproj.io/metallb created
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$


hsuma@plnx-admin:~/ocp-ai-config$ oc describe application metallb -n openshift-gitops | tail -30
hsuma@plnx-admin:~/ocp-ai-config$ oc describe application metallb -n openshift-gitops | tail -30
        Duration:      5s
        Factor:        2
        Max Duration:  3m
      Limit:           5
    Sync Options:
      ServerSideApply=true
Status:
  Conditions:
    Last Transition Time:  2026-02-26T03:38:19Z
    Message:               Failed to load target state: failed to generate manifest for source 1 of 1: rpc error: code = Unknown desc = ocp-ai-config/metallb: app path does not exist
    Type:                  ComparisonError
  Controller Namespace:    openshift-gitops
  Health:
    Last Transition Time:  2026-02-26T03:38:20Z
    Status:                Healthy
  Reconciled At:           2026-02-26T03:38:19Z
  Sync:
    Compared To:
      Destination:
        Server:  https://kubernetes.default.svc
      Source:
        Path:             ocp-ai-config/metallb
        Repo URL:         git@bitbucket.org:calixprod/ocp-ai-platform.git
        Target Revision:  main
    Status:               Unknown
Events:
  Type    Reason           Age    From                           Message
  ----    ------           ----   ----                           -------
  Normal  ResourceUpdated  2m12s  argocd-application-controller  Updated sync status:  -> Unknown
  Normal  ResourceUpdated  2m12s  argocd-application-controller  Updated health status:  -> Healthy




hsuma@plnx-admin:~/ocp-ai-config$ oc describe application metallb -n openshift-gitops | tail -30
        Duration:      5s
        Factor:        2
        Max Duration:  3m
      Limit:           5
    Sync Options:
      ServerSideApply=true
Status:
  Conditions:
    Last Transition Time:  2026-02-26T03:38:19Z
    Message:               Failed to load target state: failed to generate manifest for source 1 of 1: rpc error: code = Unknown desc = ocp-ai-config/metallb: app path does not exist
    Type:                  ComparisonError
  Controller Namespace:    openshift-gitops
  Health:
    Last Transition Time:  2026-02-26T03:38:20Z
    Status:                Healthy
  Reconciled At:           2026-02-26T03:46:26Z
  Sync:
    Compared To:
      Destination:
        Server:  https://kubernetes.default.svc
      Source:
        Path:             ocp-ai-config/metallb
        Repo URL:         git@bitbucket.org:calixprod/ocp-ai-platform.git
        Target Revision:  main
    Status:               Unknown
Events:
  Type    Reason           Age    From                           Message
  ----    ------           ----   ----                           -------
  Normal  ResourceUpdated  8m56s  argocd-application-controller  Updated sync status:  -> Unknown
  Normal  ResourceUpdated  8m56s  argocd-application-controller  Updated health status:  -> Healthy
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ git ls-files m
hsuma@plnx-admin:~/ocp-ai-config$ git ls-files metallb/
metallb/argocd-app.metallb.yaml
metallb/ipaddresspools.yaml
metallb/l2advertisement.yaml
metallb/metallb-instance.yaml
metallb/namespaces.yaml
hsuma@plnx-admin:~/ocp-ai-config$

hsuma@plnx-admin:~/ocp-ai-config$ git remote -v
origin	git@bitbucket.org:calixprod/ocp-ai-platform.git (fetch)
origin	git@bitbucket.org:calixprod/ocp-ai-platform.git (push)
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ pwd
/home/hsuma/ocp-ai-config
hsuma@plnx-admin:~/ocp-ai-config$ ls -la
total 48
drwxr-xr-x  8 hsuma sw  4096 Feb 25 21:23 .
drwxr-xr-x 46 hsuma sw 16384 Feb 25 21:45 ..
drwxr-xr-x  2 hsuma sw  4096 Feb 23 13:41 apps
drwxr-xr-x  8 hsuma sw  4096 Feb 25 21:44 .git
-rw-r--r--  1 hsuma sw    22 Feb 19 13:55 .gitignore
drwxr-xr-x  2 hsuma sw  4096 Feb 18 14:24 machineconfigs
drwxr-xr-x  2 hsuma sw  4096 Feb 25 21:43 metallb
drwxr-xr-x  2 hsuma sw  4096 Feb 23 22:28 nmstate
-rw-r--r--  1 hsuma sw  2622 Feb 19 13:55 README.md
drwxr-xr-x  2 hsuma sw  4096 Feb 23 19:15 trident
hsuma@plnx-admin:~/ocp-ai-config$



hsuma@plnx-admin:~/ocp-ai-config$ oc get application -A
NAMESPACE          NAME              SYNC STATUS   HEALTH STATUS
openshift-gitops   machineconfigs    Synced        Healthy
openshift-gitops   metallb           Unknown       Healthy
openshift-gitops   nmstate           Synced        Healthy
openshift-gitops   ocp-ai-platform   Synced        Healthy
openshift-gitops   trident           Synced        Healthy
hsuma@plnx-admin:~/ocp-ai-config$ oc describe application metallb -n openshift-gitops | tail -30
    Status:            Unknown
    Version:           v1
    Group:             project.openshift.io
    Kind:              Project
    Name:              pai-test
    Status:            Unknown
    Version:           v1
  Source Hydrator:
  Summary:
    Images:
      registry.redhat.io/openshift4/metallb-rhel9@sha256:668b065e49be9ff1b0ca2e13e504afe5ff4483aec6bf54c9413d9b435b97d6a8
      registry.redhat.io/openshift4/ose-kube-rbac-proxy-rhel9@sha256:5f4b6b4ddff81c2b6e1bb43e0924197ef184132ccb105ef816065bfebe25d002
  Sync:
    Compared To:
      Destination:
        Server:  https://kubernetes.default.svc
      Source:
        Path:             ocp-ai-config/metallb
        Repo URL:         git@bitbucket.org:calixprod/ocp-ai-platform.git
        Target Revision:  main
    Status:               Unknown
Events:
  Type    Reason              Age    From                           Message
  ----    ------              ----   ----                           -------
  Normal  ResourceUpdated     16m    argocd-application-controller  Updated sync status:  -> Unknown
  Normal  ResourceUpdated     16m    argocd-application-controller  Updated health status:  -> Healthy
  Normal  OperationStarted    2m51s  argocd-application-controller  Initiated automated sync to 'b01d9d89a138f16b727c2072bfb42b200da17e3f'
  Normal  ResourceUpdated     2m51s  argocd-application-controller  Updated sync status: Unknown -> OutOfSync
  Normal  OperationCompleted  2m49s  argocd-application-controller  Sync operation to b01d9d89a138f16b727c2072bfb42b200da17e3f succeeded
  Normal  ResourceUpdated     2m48s  argocd-application-controller  Updated sync status: OutOfSync -> Unknown
hsuma@plnx-admin:~/ocp-ai-config$


oc delete application metallb -n openshift-gitops

oc apply -f - <<EOF
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: metallb
  namespace: openshift-gitops
  labels:
    app.kubernetes.io/part-of: ocp-ai-platform
spec:
  project: default
  source:
    repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
    targetRevision: main
    path: metallb
  destination:
    server: https://kubernetes.default.svc
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m
EOF


hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ cat apps/root-app.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: ocp-ai-platform
  namespace: openshift-gitops
spec:
  project: default
  source:
    repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
    targetRevision: main
    path: apps
  destination:
    server: https://kubernetes.default.svc
  syncPolicy:
    automated:
      selfHeal: true
      prune: false
hsuma@plnx-admin:~/ocp-ai-config$


oc patch application metallb -n openshift-gitops --type merge -p '{"metadata":{"finalizers":null}}'


Application conditions
ComparisonError
Failed to load target state: failed to generate manifest for source 1 of 1: rpc error: code = Unknown desc = ocp-ai-config/metallb: app path does not exist


hsuma@plnx-admin:~/ocp-ai-config$ oc get application metallb -n openshift-gitops -o jsonpath='{.spec.source.path}'
ocp-ai-config/metallbhsuma@plnx-admin:~/ocp-ai-config$


hsuma@plnx-admin:~/ocp-ai-config$


hsuma@plnx-admin:~/ocp-ai-config$ cat apps/test.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
  name: gitops-nmstate-access
rules:
- apiGroups:
  - nmstate.io
  resources:
  - nodenetworkconfiguration
  verbs:
  - get
  - list
  - watch
hsuma@plnx-admin:~/ocp-ai-config$


project: default
source:
  repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
  path: trident
  targetRevision: main
destination:
  server: https://kubernetes.default.svc
  namespace: trident
syncPolicy:
  automated:
    prune: true
    selfHeal: true
  syncOptions:
    - CreateNamepace=false

oc apply -f - <<EOF
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: metallb
  namespace: openshift-gitops
spec:
  project: default
  source:
    repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
    targetRevision: main
    path: metallb
  destination:
    server: https://kubernetes.default.svc
    namespace: metallb-system
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
EOF


oc delete application metallb -n openshift-gitops 2>/dev/null; sleep 5

oc apply -f - <<EOF
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: metallb
  namespace: openshift-gitops
spec:
  project: default
  source:
    repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
    targetRevision: main
    path: metallb
  destination:
    server: https://kubernetes.default.svc
    namespace: metallb-system
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
EOF


oc rollout restart deployment openshift-gitops-server -n openshift-gitops
oc rollout restart statefulset openshift-gitops-application-controller -n openshift-gitops



hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get application trident -n openshift-gitops -o jsonpath='{.spec.source.path}'
tridenthsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get application ocp-ai-platform -n openshift-gitops -o jsonpath='{.spec.source.path}'
appshsuma@plnx-admin:~/ocp-ai-config/apps$


hsuma@plnx-admin:~/ocp-ai-config/apps$ git ls-tree --name-only HEAD
machineconfigs-app.yaml
nmstate-app.yaml
root-app.yaml
trident-apps.yaml
hsuma@plnx-admin:~/ocp-ai-config/apps$




cat > ~/ocp-ai-config/apps/metallb-app.yaml <<EOF
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: metallb
  namespace: openshift-gitops
spec:
  project: default
  source:
    repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
    targetRevision: main
    path: metallb
  destination:
    server: https://kubernetes.default.svc
    namespace: metallb-system
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
EOF





cat > ~/ocp-ai-config/apps/metallb-app.yaml <<EOF
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: metallb
  namespace: openshift-gitops
spec:
  project: default
  source:
    repoURL: git@bitbucket.org:calixprod/ocp-ai-platform.git
    targetRevision: main
    path: metallb
  destination:
    server: https://kubernetes.default.svc
    namespace: metallb-system
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
EOF



hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get application -n openshift-gitops -w
NAME              SYNC STATUS   HEALTH STATUS
machineconfigs    Synced        Healthy
metallb           Synced        Healthy
nmstate           Synced        Healthy
ocp-ai-platform   Synced        Healthy
trident           Synced        Healthy
^Chsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get metallb -n metallb-system
NAME      AGE
metallb   83s
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get ipaddresspools -n metallb-system
NAME                AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES
pai-services-dev    false         false             ["10.172.248.160-10.172.248.163"]
pai-services-prod   false         false             ["10.172.248.170-10.172.248.173"]
pai-services-test   false         false             ["10.172.248.165-10.172.248.168"]
reserved-future     false         false             ["10.172.248.175-10.172.248.180"]
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get l2advertisements -n metallb-system
NAME          IPADDRESSPOOLS                                                 IPADDRESSPOOL SELECTORS   INTERFACES
l2-vlan1510   ["pai-services-dev","pai-services-test","pai-services-prod"]
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get pods -n metallb-system
NAME                                                   READY   STATUS    RESTARTS   AGE
controller-fb7fcb695-hhhnq                             2/2     Running   0          2m9s
metallb-operator-controller-manager-68b4948857-hn29n   1/1     Running   0          123m
metallb-operator-webhook-server-6c48f9b746-ln7vr       1/1     Running   0          123m
speaker-h9xxx                                          2/2     Running   0          2m9s
speaker-k5k8b                                          2/2     Running   0          2m9s
speaker-nn6pq                                          2/2     Running   0          2m9s
hsuma@plnx-admin:~/ocp-ai-config/apps$


hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc explain metallb.spec --api-version=metallb.io/v1beta1
GROUP:      metallb.io
KIND:       MetalLB
VERSION:    v1beta1

FIELD: spec <Object>


DESCRIPTION:
    MetalLBSpec defines the desired state of MetalLB

FIELDS:
  bgpBackend	<string>
    The type of BGP implementation deployed with MetalLB

  controllerConfig	<Object>
    additional configs to be applied on MetalLB Controller deployment.

  controllerNodeSelector	<map[string]string>
    node selector applied to MetalLB controller deployment.

  controllerTolerations	<[]Object>
    tolerations is a list of tolerations applied to MetalLB controller
    deployment.

  frrk8sConfig	<Object>
    The specific frr-k8s configuration

  image	<string>
    Foo is an example field of MetalLB. Edit MetalLB_types.go to remove/update

  loadBalancerClass	<string>
    The loadBalancerClass spec attribute that the MetalLB controller should
    be watching for. must be a label-style identifier, with an optional
    prefix such as "internal-vip" or "example.com/internal-vip". Unprefixed
    names are reserved for end-users.

  logLevel	<string>
  enum: all, debug, info, warn, ....
    Define the verbosity of the controller and the speaker logging.
    Allowed values are: all, debug, info, warn, error, none. (default: info)

  nodeSelector	<map[string]string>
    node selector applied to MetalLB speaker daemonset.

  speakerConfig	<Object>
    additional configs to be applied on MetalLB Speaker daemonset.

  speakerTolerations	<[]Object>
    tolerations is a list of tolerations applied to MetalLB speaker
    daemonset.


hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc explain metallb.spec.controllerConfig --api-version=metallb.io/v1beta1
GROUP:      metallb.io
KIND:       MetalLB
VERSION:    v1beta1

FIELD: controllerConfig <Object>


DESCRIPTION:
    additional configs to be applied on MetalLB Controller deployment.

FIELDS:
  affinity	<Object>
    If specified, the pod's scheduling constraints

  annotations	<map[string]string>
    Annotations to be applied for MetalLB Operator

  priorityClassName	<string>
    Define priority class name

  resources	<Object>
    Resource Requirements to be applied for containers which gets deployed
    via MetalLB Operator

  runtimeClassName	<string>
    Define container runtime configuration class


hsuma@plnx-admin:~/ocp-ai-config/apps$



oc apply -f - <<EOF
apiVersion: gateway.networking.k8s.io/v1
kind: GatewayClass
metadata:
  name: openshift-default
spec:
  controllerName: openshift.io/gateway-controller/v1
EOF



^Chsuma@plnx-admin:~/ocp-ai-config/apps$ oc get pods -n openshift-ingress
NAME                                        READY   STATUS    RESTARTS   AGE
istiod-openshift-gateway-7cd77c7ffd-7wxpq   1/1     Running   0          16s
router-default-56fb65447b-87hkv             1/1     Running   0          2d3h
router-default-56fb65447b-g8jhd             1/1     Running   0          2d3h
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$



oc apply -f - <<EOF
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: pai-gateway
  namespace: openshift-ingress
spec:
  gatewayClassName: openshift-default
  listeners:
    - name: http
      port: 80
      protocol: HTTP
      allowedRoutes:
        namespaces:
          from: Selector
          selector:
            matchLabels:
              app.kubernetes.io/part-of: pai
EOF


gateway.gateway.networking.k8s.io/pai-gateway created
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get gateway -n openshift-ingress
NAME          CLASS               ADDRESS   PROGRAMMED   AGE
pai-gateway   openshift-default             False        20s
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get gateway -n openshift-ingress
NAME          CLASS               ADDRESS   PROGRAMMED   AGE
pai-gateway   openshift-default             False        22s
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get pods -n openshift-ingress
NAME                                             READY   STATUS    RESTARTS   AGE
istiod-openshift-gateway-7cd77c7ffd-7wxpq        1/1     Running   0          2m58s
pai-gateway-openshift-default-59c9d58c94-cnmk9   1/1     Running   0          32s
router-default-56fb65447b-87hkv                  1/1     Running   0          2d3h
router-default-56fb65447b-g8jhd                  1/1     Running   0          2d3h
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get svc -n openshift-ingress
NAME                            TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                                 AGE
istiod-openshift-gateway        ClusterIP      172.30.66.226   <none>        15010/TCP,15012/TCP,443/TCP,15014/TCP   3m6s
pai-gateway-openshift-default   LoadBalancer   172.30.31.98    <pending>     15021:30643/TCP,80:31594/TCP            40s
router-internal-default         ClusterIP      172.30.16.162   <none>        80/TCP,443/TCP,1936/TCP                 10d
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get svc -n openshift-ingress
NAME                            TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                                 AGE
istiod-openshift-gateway        ClusterIP      172.30.66.226   <none>        15010/TCP,15012/TCP,443/TCP,15014/TCP   3m11s
pai-gateway-openshift-default   LoadBalancer   172.30.31.98    <pending>     15021:30643/TCP,80:31594/TCP            45s
router-internal-default         ClusterIP      172.30.16.162   <none>        80/TCP,443/TCP,1936/TCP                 10d
hsuma@plnx-admin:~/ocp-ai-config/apps$



oc annotate svc pai-gateway-openshift-default -n openshift-ingress \
  metallb.universe.tf/address-pool=reserved-future \
  metallb.universe.tf/loadBalancerIPs=10.172.248.175



hsuma@plnx-admin:~/ocp-ai-config/apps$ oc annotate svc pai-gateway-openshift-default -n openshift-ingress \
  metallb.universe.tf/address-pool=reserved-future \
  metallb.universe.tf/loadBalancerIPs=10.172.248.175
service/pai-gateway-openshift-default annotated
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get svc -n openshift-ingress
NAME                            TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)                                 AGE
istiod-openshift-gateway        ClusterIP      172.30.66.226   <none>           15010/TCP,15012/TCP,443/TCP,15014/TCP   5m4s
pai-gateway-openshift-default   LoadBalancer   172.30.31.98    10.172.248.175   15021:30643/TCP,80:31594/TCP            2m38s
router-internal-default         ClusterIP      172.30.16.162   <none>           80/TCP,443/TCP,1936/TCP                 10d
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get gateway -n openshift-ingress
NAME          CLASS               ADDRESS          PROGRAMMED   AGE
pai-gateway   openshift-default   10.172.248.175   True         3m3s
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get pods -n pai-dev -w
^Chsuma@plnx-admin:~/ocp-ai-config/apps$ oc create deployment httpbin --image=registry.access.redhat.com/ubi9/httpd-24:latest -n pai-dev
deployment.apps/httpbin created
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc expose deployment httpbin --port=8080 -n pai-dev
service/httpbin exposed
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get pods -n pai-dev
NAME                       READY   STATUS    RESTARTS   AGE
httpbin-749cb56f8b-jlv6s   1/1     Running   0          27s
hsuma@plnx-admin:~/ocp-ai-config/apps$


oc apply -f - <<EOF
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: httpbin-route
  namespace: pai-dev
spec:
  parentRefs:
    - name: pai-gateway
      namespace: openshift-ingress
  hostnames:
    - httpbin-dev.apps.ocp-ai.calix.local
  rules:
    - backendRefs:
        - name: httpbin
          port: 8080
EOF


httproute.gateway.networking.k8s.io/httpbin-route created
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ curl -s -o /dev/null -w  "%{http_code}"  -H "Host: httpbin-dev.apps.ocp-ai.calix.local" http://10.172.248.175
000hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ curl -s -o /dev/null -w  "%{http_code}"  -H "Host: httpbin-dev.apps.ocp-ai.calix.local" http://10.172.248.175
000hsuma@plnx-admin:~/ocp-ai-config/apps$



hsuma@plnx-admin:~/ocp-ai-config/apps$
hsuma@plnx-admin:~/ocp-ai-config/apps$ oc get httproute httpbin-route -n pai-dev -o yaml | grep -A10 status
status:
  parents:
  - conditions:
    - lastTransitionTime: "2026-02-26T04:57:50Z"
      message: Route was valid
      observedGeneration: 1
      reason: Accepted
      status: "True"
      type: Accepted
    - lastTransitionTime: "2026-02-26T04:57:50Z"
      message: All references resolved
      observedGeneration: 1
      reason: ResolvedRefs
      status: "True"
      type: ResolvedRefs
    controllerName: openshift.io/gateway-controller/v1
    parentRef:
      group: gateway.networking.k8s.io
      kind: Gateway
      name: pai-gateway
      namespace: openshift-ingress
hsuma@plnx-admin:~/ocp-ai-config/apps$


hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get l2advertisement l2-vlan1510 -n metallb-system -o jsonpath='{.spec.ipAddressPools}'
["pai-services-dev","pai-services-test","pai-services-prod","reserved-future"]hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ sudo arping -c 3 -I ens33 10.172.248.175
ARPING 10.172.248.175
60 bytes from 00:25:b5:51:0b:68 (10.172.248.175): index=0 time=383.687 usec
60 bytes from 00:25:b5:50:0a:68 (10.172.248.175): index=1 time=546.440 usec
60 bytes from 00:25:b5:50:0a:68 (10.172.248.175): index=2 time=375.323 usec
60 bytes from 00:25:b5:51:0b:68 (10.172.248.175): index=3 time=525.837 usec
60 bytes from 00:25:b5:51:0b:68 (10.172.248.175): index=4 time=378.798 usec
60 bytes from 00:25:b5:50:0a:68 (10.172.248.175): index=5 time=462.142 usec
^C
--- 10.172.248.175 statistics ---
3 packets transmitted, 6 packets received,   0% unanswered (3 extra)
rtt min/avg/max/std-dev = 0.375/0.445/0.546/0.071 ms
hsuma@plnx-admin:~/ocp-ai-config$



hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get secretstores,clustersecretstores -A
NAMESPACE   NAME                                          AGE    STATUS   CAPABILITIES   READY
trident     secretstore.external-secrets.io/vault-store   2d5h
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get serviceaccount -n external-secrets
No resources found in external-secrets namespace.
hsuma@plnx-admin:~/ocp-ai-config$
