hsuma@plnx-admin:~$ oc get pods -n metallb-system
NAME                                                   READY   STATUS    RESTARTS   AGE
metallb-operator-controller-manager-68b4948857-hn29n   1/1     Running   0          2m45s
metallb-operator-webhook-server-6c48f9b746-ln7vr       1/1     Running   0          2m45s


oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: MetalLB
metadata:
  name: metallb
  namespace: metallb-system
spec:
  logLevel: warn
EOF


hsuma@plnx-admin:~$
hsuma@plnx-admin:~$ oc get pods -n metallb-system -o wide
NAME                                                   READY   STATUS    RESTARTS   AGE     IP               NODE                          NOMINATED NODE   READINESS GATES
controller-fb7fcb695-ltvg5                             2/2     Running   0          44s     10.128.0.198     ocp-ai-master02.calix.local   <none>           <none>
metallb-operator-controller-manager-68b4948857-hn29n   1/1     Running   0          8m51s   10.129.0.150     ocp-ai-master01.calix.local   <none>           <none>
metallb-operator-webhook-server-6c48f9b746-ln7vr       1/1     Running   0          8m51s   10.129.0.151     ocp-ai-master01.calix.local   <none>           <none>
speaker-52dbz                                          2/2     Running   0          44s     10.172.248.152   ocp-ai-master03.calix.local   <none>           <none>
speaker-6wx7x                                          2/2     Running   0          44s     10.172.248.150   ocp-ai-master01.calix.local   <none>           <none>
speaker-k2cnq                                          2/2     Running   0          44s     10.172.248.151   ocp-ai-master02.calix.local   <none>           <none>


oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: ai-services-dev
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.160-10.172.248.163
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: ai-services-test
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.165-10.172.248.168
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: ai-services-prod
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.170-10.172.248.173
  autoAssign: false
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: reserved-future
  namespace: metallb-system
spec:
  addresses:
    - 10.172.248.175-10.172.248.180
  autoAssign: false
EOF



ipaddresspool.metallb.io/ai-services-dev created
ipaddresspool.metallb.io/ai-services-test created
ipaddresspool.metallb.io/ai-services-prod created
ipaddresspool.metallb.io/reserved-future created



oc apply -f - <<EOF
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: l2-vlan1510
  namespace: metallb-system
spec:
  ipAddressPools:
    - ai-services-dev
    - ai-services-test
    - ai-services-prod
EOF




oc apply -f - <<EOF
apiVersion: v1
kind: Namespace
metadata:
  name: pai-dev
  labels:
    env: dev
    app.kubernetes.io/part-of: pai
---
apiVersion: v1
kind: Namespace
metadata:
  name: pai-test
  labels:
    env: test
    app.kubernetes.io/part-of: pai
---
apiVersion: v1
kind: Namespace
metadata:
  name: pai-prod
  labels:
    env: prod
    app.kubernetes.io/part-of: pai
EOF



oc apply -f - <<EOF
apiVersion: v1
kind: Service
metadata:
  name: nginx-test-lb
  namespace: pai-dev
  annotations:
    metallb.universe.tf/address-pool: ai-services-dev
    metallb.universe.tf/loadBalancerIPs: "10.172.248.160"
spec:
  type: LoadBalancer
  loadBalancerIP: "10.172.248.160"
  ports:
    - port: 80
      targetPort: 8080
  selector:
    app: nginx-test
EOF
