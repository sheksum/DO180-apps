DEV_PASS=$(openssl rand -base64 24)
TEST_PASS=$(openssl rand -base64 24)
PROD_PASS=$(openssl rand -base64 24)

echo "Dev:  $DEV_PASS"
echo "Test: $TEST_PASS"
echo "Prod: $PROD_PASS"

vault kv put kv/pai/dev/minio-credentials MINIO_ROOT_USER=minioadmin MINIO_ROOT_PASSWORD="$DEV_PASS"
vault kv put kv/pai/test/minio-credentials MINIO_ROOT_USER=minioadmin MINIO_ROOT_PASSWORD="$TEST_PASS"
vault kv put kv/pai/prod/minio-credentials MINIO_ROOT_USER=minioadmin MINIO_ROOT_PASSWORD="$PROD_PASS"


# Copy 01-external-secrets.yaml and 02-minio-all-envs.yaml to plnx-admin first
# Then:
oc apply -f 01-external-secrets.yaml

# Wait for sync, verify
oc get externalsecrets -A | grep minio
# All three should show SecretSynced / True


oc apply -f 02-minio-all-envs.yaml


# Pods running
oc get pods -n pai-dev -l app=minio
oc get pods -n pai-test -l app=minio
oc get pods -n pai-prod -l app=minio

# LB IPs assigned
oc get svc -A --field-selector spec.type=LoadBalancer

# HTTPRoutes
oc get httproutes -A | grep minio

# Health check
curl -sk https://minio.dev.ocp-ai.calix.local

hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get secret storage-configuration -n aistor -o yaml 2>/dev/null
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc get secret -n aistor
NAME                                  TYPE                      DATA   AGE
aistor-adminjob-dockercfg-9tg2n       kubernetes.io/dockercfg   1      18m
aistor-object-store-dockercfg-2bv7n   kubernetes.io/dockercfg   1      18m
builder-dockercfg-pl654               kubernetes.io/dockercfg   1      18m
default-dockercfg-tsz8m               kubernetes.io/dockercfg   1      18m
deployer-dockercfg-q9t4f              kubernetes.io/dockercfg   1      18m
object-store-operator-tls             kubernetes.io/tls         2      18m
object-store-webhook-service-cert     kubernetes.io/tls         3      18m
hsuma@plnx-admin:~/ocp-ai-config$
