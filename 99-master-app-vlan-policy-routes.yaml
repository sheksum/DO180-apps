# Get the Calix CA chain that the API server cert is signed by
openssl s_client -connect api.ocp-ai.calix.local:6443 -servername api.ocp-ai.calix.local -showcerts 2>/dev/null | awk '/BEGIN CERTIFICATE/,/END CERTIFICATE/' > /tmp/api-ca-chain.pem

# Combine both
cat /tmp/k8s-ca.pem /tmp/api-ca-chain.pem > /tmp/combined-ca.pem

# Verify it works
curl --cacert /tmp/combined-ca.pem https://api.ocp-ai.calix.local:6443/api/v1/namespaces

vault write auth/kubernetes-ocp-ai/config \
  kubernetes_host="https://api.ocp-ai.calix.local:6443" \
  token_reviewer_jwt="<same-token-as-before>" \
  kubernetes_ca_cert=@/tmp/combined-ca.pem
