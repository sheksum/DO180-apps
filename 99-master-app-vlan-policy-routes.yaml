DEV_PASS=$(openssl rand -base64 24)
TEST_PASS=$(openssl rand -base64 24)
PROD_PASS=$(openssl rand -base64 24)

echo "Dev:  $DEV_PASS"
echo "Test: $TEST_PASS"
echo "Prod: $PROD_PASS"

vault kv put kv/pai/dev/minio-credentials MINIO_ROOT_USER=minioadmin MINIO_ROOT_PASSWORD="$DEV_PASS"
vault kv put kv/pai/test/minio-credentials MINIO_ROOT_USER=minioadmin MINIO_ROOT_PASSWORD="$TEST_PASS"
vault kv put kv/pai/prod/minio-credentials MINIO_ROOT_USER=minioadmin MINIO_ROOT_PASSWORD="$PROD_PASS"


# Copy 01-external-secrets.yaml and 02-minio-all-envs.yaml to plnx-admin first
# Then:
oc apply -f 01-external-secrets.yaml

# Wait for sync, verify
oc get externalsecrets -A | grep minio
# All three should show SecretSynced / True


oc apply -f 02-minio-all-envs.yaml


# Pods running
oc get pods -n pai-dev -l app=minio
oc get pods -n pai-test -l app=minio
oc get pods -n pai-prod -l app=minio

# LB IPs assigned
oc get svc -A --field-selector spec.type=LoadBalancer

# HTTPRoutes
oc get httproutes -A | grep minio

# Health check
curl -sk https://minio.dev.ocp-ai.calix.local



# On plnx-admin:
oc get secretstore vault-store -n pai-dev -o yaml | grep -A15 "provider:"
hsuma@plnx-admin:~/ocp-ai-config$ oc explain objectstore.spec.configuration --api-version=aistor.min.io/v1
GROUP:      aistor.min.io
KIND:       ObjectStore
VERSION:    v1

FIELD: configuration <Object>


DESCRIPTION:
    <empty>
FIELDS:
  name	<string>
    <no description>


hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$
hsuma@plnx-admin:~/ocp-ai-config$ oc explain objectstore.spec.pools.volumeClaimTemplate --api-version=aistor.min.io/v1
GROUP:      aistor.min.io
KIND:       ObjectStore
VERSION:    v1

FIELD: volumeClaimTemplate <Object>


DESCRIPTION:
    <empty>
FIELDS:
  apiVersion	<string>
    <no description>

  kind	<string>
    <no description>

  metadata	<Object>
    <no description>

  spec	<Object>
    <no description>

  status	<Object>
    <no description>


hsuma@plnx-admin:~/ocp-ai-config$

