# Node status
oc get nodes
oc get mcp worker

# MC status
oc get mc 99-worker-nm-dns-fix -o jsonpath='{.spec.config.ignition.version}{"\n"}'

# On gpu01
ssh -i ~/.ssh/ocp-ai core@10.172.248.153 << 'DIAG'
echo "=== systemctl status ==="
sudo systemctl status ensure-nm-dns.service
echo "=== journalctl ==="
sudo journalctl -u ensure-nm-dns.service --no-pager
echo "=== /var/run/NetworkManager/resolv.conf ==="
cat /var/run/NetworkManager/resolv.conf
echo "=== /etc/resolv.conf ==="
cat /etc/resolv.conf
echo "=== nmcli ovs-if-br-ex ==="
nmcli connection show ovs-if-br-ex 2>&1 | grep -E "ipv4.dns|ipv4.dns-priority|GENERAL.STATE"
echo "=== script on disk ==="
ls -la /usr/local/bin/ensure-nm-dns.sh
echo "=== systemd unit ==="
cat /etc/systemd/system/ensure-nm-dns.service
echo "=== resolv-prepender flag ==="
ls -la /run/resolv-prepender-kni-conf-done 2>&1
echo "=== kubelet status ==="
sudo systemctl status kubelet | head -5
echo "=== kni coredns ==="
sudo crictl ps 2>/dev/null | grep coredns || echo "crictl not available"
DIAG
