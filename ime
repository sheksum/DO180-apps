cd ~/ocp-ai-config
cat > machineconfigs/99-worker-nm-dns-fix.yaml << 'EOF'
# OCP-AI NM DNS Fix - Feb 26 2026 v2 - Haj Suma
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  name: 99-worker-nm-dns-fix
  labels:
    machineconfiguration.openshift.io/role: worker
spec:
  config:
    ignition:
      version: 3.5.0
    storage:
      files:
        - path: /etc/NetworkManager/conf.d/90-dns-fix.conf
          mode: 0644
          overwrite: true
          contents:
            source: "data:text/plain;charset=utf-8;base64,W2dsb2JhbC1kbnMtZG9tYWluLSpdCnNlcnZlcnM9MTAuMTcyLjI0OC4zMSwxMC4xNzIuMjQ4LjMyCgpbZ2xvYmFsLWRuc10Kc2VhcmNoZXM9Y2FsaXgubG9jYWwK"
        - path: /usr/local/bin/ensure-nm-dns.sh
          mode: 0755
          overwrite: true
          contents:
            source: "data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKUkVTT0xWPSIvdmFyL3J1bi9OZXR3b3JrTWFuYWdlci9yZXNvbHYuY29uZiIKRE5TMT0iMTAuMTcyLjI0OC4zMSIKRE5TMj0iMTAuMTcyLjI0OC4zMiIKU0VBUkNIPSJjYWxpeC5sb2NhbCIKTUFYX1dBSVQ9MzAKSU5URVJWQUw9MgoKZWNobyAiW2Vuc3VyZS1ubS1kbnNdIFdhaXRpbmcgZm9yIE5NIHJlc29sdi5jb25mIChtYXggJHtNQVhfV0FJVH1zKS4uLiIKCmVsYXBzZWQ9MAp3aGlsZSBbICEgLWYgIiRSRVNPTFYiIF07IGRvCiAgaWYgWyAkZWxhcHNlZCAtZ2UgJE1BWF9XQUlUIF07IHRoZW4KICAgIGVjaG8gIltlbnN1cmUtbm0tZG5zXSBXQVJOOiAke1JFU09MVn0gbm90IGZvdW5kIGFmdGVyICR7TUFYX1dBSVR9cywgY3JlYXRpbmcgaXQiCiAgICBta2RpciAtcCAvdmFyL3J1bi9OZXR3b3JrTWFuYWdlcgogICAgYnJlYWsKICBmaQogIHNsZWVwICRJTlRFUlZBTAogIGVsYXBzZWQ9JCgoZWxhcHNlZCArIElOVEVSVkFMKSkKZG9uZQoKIyBBbHdheXMgd3JpdGUgRE5TIHRvIHJlc29sdi5jb25mCnByaW50ZiAic2VhcmNoICVzXG5uYW1lc2VydmVyICVzXG5uYW1lc2VydmVyICVzXG4iICIkU0VBUkNIIiAiJEROUzEiICIkRE5TMiIgPiAiJFJFU09MViIKCmVjaG8gIltlbnN1cmUtbm0tZG5zXSBETlMgaW5qZWN0ZWQgaW50byAke1JFU09MVn0iCmNhdCAiJFJFU09MViIKZXhpdCAwCg=="
    systemd:
      units:
        - name: ensure-nm-dns.service
          enabled: true
          contents: |
            [Unit]
            Description=Ensure NM resolv.conf has DNS servers (OVN-K bare-metal fix)
            After=NetworkManager.service
            Before=kubelet.service
            Before=nodeip-configuration.service

            [Service]
            Type=oneshot
            RemainAfterExit=yes
            ExecStart=/usr/local/bin/ensure-nm-dns.sh
            TimeoutStartSec=180

            [Install]
            WantedBy=multi-user.target
EOF
git add machineconfigs/99-worker-nm-dns-fix.yaml
git commit -m "NM DNS fix v2: add global-dns config drop-in to persist DNS across NM restarts"
git push origin main
