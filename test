- name: Fetch available host groups from Satellite
  delegate_to: localhost
  shell: |
    hammer --server https://{{ satellite_fqdn }} \
           --username {{ satellite_user }} \
           --password '{{ satellite_password }}' \
           hostgroup list --per-page 100 --order name | awk 'NR > 1 { print $2, $3, $4, $5 }'
  register: hostgroup_list
  changed_when: false

- name: Show available host groups
  debug:
    msg: |
      Available Host Groups:
      {% for group in hostgroup_list.stdout_lines %}
      {{ loop.index }}. {{ group }}
      {% endfor %}

- name: Prompt for activation keys and hostgroup selection
  pause:
    prompt: |
      Enter activation key for RHEL 8 systems: (e.g., smx-rhel8-key)
  register: rhel8_key_input

- name: Save activation key for RHEL 8
  set_fact:
    activation_key_rhel8: "{{ rhel8_key_input.user_input }}"

- name: Prompt for activation key for RHEL 9
  pause:
    prompt: |
      Enter activation key for RHEL 9 systems: (e.g., smx-rhel9-key)
  register: rhel9_key_input

- name: Save activation key for RHEL 9
  set_fact:
    activation_key_rhel9: "{{ rhel9_key_input.user_input }}"

- name: Prompt for host group selection by number
  pause:
    prompt: "Enter the number of the host group to use (1-...):"
  register: hostgroup_selection_input

- name: Set selected host group
  set_fact:
    selected_hostgroup: "{{ hostgroup_list.stdout_lines[(hostgroup_selection_input.user_input | int) - 1] }}"
