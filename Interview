#!/bin/bash
echo -e "\n===== Calico BGP Peering Status Check =====\n"

for pod in $(kubectl get pods -n calico-system -l k8s-app=calico-node -o jsonpath='{.items[*].metadata.name}'); do
  echo -e "\n>>> Pod: $pod <<<"

  # Try running birdc show protocols
  if output=$(kubectl exec -it "$pod" -n calico-system -c calico-node -- birdc show protocols 2>/dev/null); then
    echo "$output"
  else
    echo "⚠️  $pod: Failed to exec or run birdc"
  fi
done

echo -e "\n===== Done ====="
