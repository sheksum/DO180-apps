#!/bin/bash
echo -e "\n===== Calico Peering Report =====\n"

for pod in $(kubectl get pods -n calico-system -l k8s-app=calico-node -o jsonpath='{.items[*].metadata.name}'); do
  echo -e "\n>>> Pod: $pod <<<"

  # Exec into pod and run birdc without -c (interactive)
  kubectl exec -it "$pod" -n calico-system -- birdc show protocols 2>/dev/null

  if [ $? -ne 0 ]; then
    echo "⚠️  $pod: Failed to exec or run birdc"
  fi
done

echo -e "\n===== Done ====="
