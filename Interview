#!/bin/bash

NAMESPACE="calico-system"
LABEL="k8s-app=calico-node"
CONTAINER="calico-node"

echo "=== Checking Calico BGP Peering on all nodes ==="

PODS=$(kubectl get pods -n $NAMESPACE -l $LABEL -o jsonpath='{.items[*].metadata.name}')

for pod in $PODS; do
  echo -e "\n>>> $pod <<<"
  kubectl exec -n $NAMESPACE "$pod" -c $CONTAINER -- birdc show protocols all || echo "Failed to exec into $pod"
done
