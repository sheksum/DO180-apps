vault secrets enable -path=pki_root pki
vault secrets tune -max-lease-ttl=87600h pki_root


vault write -format=json pki_root/root/generate/internal \
  common_name="OCP-AI Temporary Root CA" \
  ttl=87600h | jq -r '.data.certificate' > /tmp/root-ca.pem


vault write -format=json pki_root/root/sign-intermediate \
  csr=@/tmp/ocp-ai-intermediate.csr \
  format=pem_bundle \
  ttl=43800h | jq -r '.data.certificate' > /tmp/signed-intermediate.pem


vault write pki_int/intermediate/set-signed certificate=@/tmp/signed-intermediate.pem


vault write pki_int/config/urls \
  issuing_certificates="https://plnx-vault.calix.local:8200/v1/pki_int/ca" \
  crl_distribution_points="https://plnx-vault.calix.local:8200/v1/pki_int/crl"


vault write pki_int/roles/ocp-ai \
  allowed_domains="calix.local" \
  allow_subdomains=true \
  allow_wildcard_certificates=true \
  max_ttl=8760h


vault write pki_int/issue/ocp-ai \
  common_name="test.ocp-ai.calix.local" \
  ttl=24h
