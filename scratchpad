vault secrets enable -path=pki_root pki
vault secrets tune -max-lease-ttl=87600h pki_root


vault write -format=json pki_root/root/generate/internal \
  common_name="OCP-AI Temporary Root CA" \
  ttl=87600h | jq -r '.data.certificate' > /tmp/root-ca.pem


vault write -format=json pki_root/root/sign-intermediate \
  csr=@/tmp/ocp-ai-intermediate.csr \
  format=pem_bundle \
  ttl=43800h | jq -r '.data.certificate' > /tmp/signed-intermediate.pem


vault write pki_int/intermediate/set-signed certificate=@/tmp/signed-intermediate.pem


root@plnx-vault ~]#
[root@plnx-vault ~]# vault write -format=json pki_root/root/sign-intermediate \
  csr=@/tmp/ocp-ai-intermediate.csr \
  format=pem_bundle \
  ttl=43800h | jq -r '.data.certificate' > /tmp/signed-intermediate.pem
[root@plnx-vault ~]# vault write pki_int/intermediate/set-signed certificate=@/tmp/signed-intermediate.pem
WARNING! The following warnings were returned from Vault:

  * This mount hasn't configured any authority information access (AIA)
  fields; this may make it harder for systems to find missing certificates
  in the chain or to validate revocation status of certificates. Consider
  updating /config/urls or the newly generated issuer with this information.

Key                 Value
---                 -----
existing_issuers    <nil>
existing_keys       <nil>
imported_issuers    [a4799ae0-b0ed-c853-e1fa-a3135340090a b402d59f-cf38-651b-81ec-3fd840b36a12]
imported_keys       <nil>
mapping             map[a4799ae0-b0ed-c853-e1fa-a3135340090a:05f1a2e0-20b9-89bb-8d06-ee0bb9769ea1 b402d59f-cf38-651b-81ec-3fd840b36a12:]
[root@plnx-vault ~]#
