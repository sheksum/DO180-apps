cat <<EOF | oc apply -f -
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: image-registry-storage
  namespace: openshift-image-registry
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 100Gi
  storageClassName: netapp-infra
EOF

oc patch configs.imageregistry.operator.openshift.io cluster --type merge --patch '{"spec":{"managementState":"Managed","storage":{"pvc":{"claim":"image-registry-storage"}},"replicas":2}}'



oc patch configs.imageregistry.operator.openshift.io cluster --type merge --patch '{"spec":{"defaultRoute":true}}'


oc get route -n openshift-image-registry


HOST=$(oc get route default-route -n openshift-image-registry -o jsonpath='{.spec.host}')
podman login -u kubeadmin -p $(oc whoami -t) $HOST
podman pull busybox
podman tag busybox $HOST/default/busybox:test
podman push $HOST/default/busybox:test


hsuma@plnx-admin:~$ podman login -u kubeadmin -p $(oc whoami -t) $HOST --tls-verify=false
error: no token is currently in use for this session
ERRO[0000] cannot find UID/GID for user hsuma: No subuid ranges found for user "hsuma" in /etc/subuid - check rootless mode in man pages.
WARN[0000] using rootless single mapping into the namespace. This might break some images. Check /etc/subuid and /etc/subgid for adding sub*ids
Error: no registries found in registries.conf, a registry must be provided
hsuma@plnx-admin:~$


oc rsh -n openshift-image-registry $(oc get pods -n openshift-image-registry -l docker-registry=default -o jsonpath='{.items[0].metadata.name}') touch /registry/test-write && echo "Write OK"



hsuma@plnx-admin:~$ oc rsh -n openshift-image-registry $(oc get pods -n openshift-image-registry -l docker-registry=default -o jsonpath='{.items[0].metadata.name}') touch /registry/test-write && echo "Write OK"
^Ccommand terminated with exit code 130
hsuma@plnx-admin:~$
hsuma@plnx-admin:~$
hsuma@plnx-admin:~$ oc describe pvc image-registry-storage -n openshift-image-registry
Name:          image-registry-storage
Namespace:     openshift-image-registry
StorageClass:  netapp-infra
Status:        Bound
Volume:        pvc-766e03dc-d5e4-496f-9bd0-8b38905999dd
Labels:        <none>
Annotations:   pv.kubernetes.io/bind-completed: yes
               pv.kubernetes.io/bound-by-controller: yes
               volume.beta.kubernetes.io/storage-provisioner: csi.trident.netapp.io
               volume.kubernetes.io/storage-provisioner: csi.trident.netapp.io
Finalizers:    [kubernetes.io/pvc-protection]
Capacity:      100Gi
Access Modes:  RWX
VolumeMode:    Filesystem
Used By:       image-registry-5b49fc8797-7m7d4
               image-registry-5b49fc8797-mqmsp
Events:
  Type    Reason                 Age                From                                                                                            Message
  ----    ------                 ----               ----                                                                                            -------
  Normal  Provisioning           21m                csi.trident.netapp.io_trident-controller-7cb57b6f6d-vgf24_3b4a98db-5441-47a5-abfc-6e7ade299819  External provisioner is provisioning volume for claim "openshift-image-registry/image-registry-storage"
  Normal  ExternalProvisioning   21m (x2 over 21m)  persistentvolume-controller                                                                     Waiting for a volume to be created either by the external provisioner 'csi.trident.netapp.io' or manually by the system administrator. If volume creation is delayed, please verify that the provisioner is running and correctly registered.
  Normal  ProvisioningSuccess    21m                csi.trident.netapp.io                                                                           provisioned a volume
  Normal  ProvisioningSucceeded  21m                csi.trident.netapp.io_trident-controller-7cb57b6f6d-vgf24_3b4a98db-5441-47a5-abfc-6e7ade299819  Successfully provisioned volume pvc-766e03dc-d5e4-496f-9bd0-8b38905999dd
hsuma@plnx-admin:~$
