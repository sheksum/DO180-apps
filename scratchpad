cat <<EOF | oc apply -f -
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: image-registry-storage
  namespace: openshift-image-registry
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 100Gi
  storageClassName: netapp-infra
EOF

oc patch configs.imageregistry.operator.openshift.io cluster --type merge --patch '{"spec":{"managementState":"Managed","storage":{"pvc":{"claim":"image-registry-storage"}},"replicas":2}}'



oc patch configs.imageregistry.operator.openshift.io cluster --type merge --patch '{"spec":{"defaultRoute":true}}'


oc get route -n openshift-image-registry


HOST=$(oc get route default-route -n openshift-image-registry -o jsonpath='{.spec.host}')
podman login -u kubeadmin -p $(oc whoami -t) $HOST
podman pull busybox
podman tag busybox $HOST/default/busybox:test
podman push $HOST/default/busybox:test


hsuma@plnx-admin:~$ podman login -u kubeadmin -p $(oc whoami -t) $HOST --tls-verify=false
error: no token is currently in use for this session
ERRO[0000] cannot find UID/GID for user hsuma: No subuid ranges found for user "hsuma" in /etc/subuid - check rootless mode in man pages.
WARN[0000] using rootless single mapping into the namespace. This might break some images. Check /etc/subuid and /etc/subgid for adding sub*ids
Error: no registries found in registries.conf, a registry must be provided
hsuma@plnx-admin:~$


oc rsh -n openshift-image-registry $(oc get pods -n openshift-image-registry -l docker-registry=default -o jsonpath='{.items[0].metadata.name}') touch /registry/test-write && echo "Write OK"
