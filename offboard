base64 -d << 'EOF' > ipa_ad_user_cleanup.sh
IyEvdXNyL2Jpbi9lbnYgYmFzaApzZXQgLWV1byBwaXBlZmFpbAoKTkVUQVBQX0FQST0iaHR0cHM6Ly9wbGFub19hZmZfY2wuY2FsaXgubG9jYWwvYXBpIgpORVRBUFBfQ1JFRFM9InN2Y19ob21lX2NsZWFudXA6ZDk0ZGVmNDdmMWRkNjM3NTI3MDI4NjU2YWFjNjkzNTliZmIxZjY0OTJjZjAzYzExOThiMTQyNjg2ZmE3ZTk4YyIKTkVUQVBQX1ZPTF9VVUlEPSIzODI1MDA5Yi01MDM3LTExZWYtOGRlMi1kMDM5ZWFiYmFlNDYiCk5FVEFQUF9IT01FX0JBU0U9Ii9sYWJfdW5peF9ob21lcyIKUVVBUkFOVElORV9ESVI9Il9kZWNvbW1pc3Npb25lZCIKTkVUQVBQX1NTSF9IT1NUPSJwbGFub19hZmZfY2wuY2FsaXgubG9jYWwiCk5FVEFQUF9TVk09InN2bTAiCklQQV9TRVJWRVI9InBsbi1wZXRpcGFyZXBsaWNhLmlwYS5jYWxpeC5sb2NhbCIKSVBBX1JFQUxNPSJJUEEuQ0FMSVguTE9DQUwiCklQQV9LRVlUQUI9Ii9ldGMva3JiNS9pcGFfc3ZjLmtleXRhYiIKSVBBX1BSSU5DSVBBTD0ic3ZjX3VzZXJfbGlmZWN5Y2xlQElQQS5DQUxJWC5MT0NBTCIKTE9HX0ZJTEU9Ii92YXIvbG9nL3VzZXJfb2ZmYm9hcmQubG9nIgpUSU1FU1RBTVA9JChkYXRlICslRl8lSCVNJVMpCgpsb2coKSB7IGxvY2FsIGxldmVsPSIkMSI7IGxvY2FsIG1lc3NhZ2U9IiQyIjsgZWNobyAiJChkYXRlICcrJUYgJVQnKSBbJGxldmVsXSAke1VTRVJfSUQ6LUlOSVR9IC0gJG1lc3NhZ2UiIHwgdGVlIC1hICIkTE9HX0ZJTEUiOyB9CmxvZ19pbmZvKCkgIHsgbG9nICJJTkZPIiAgIiQxIjsgfQpsb2dfd2FybigpICB7IGxvZyAiV0FSTiIgICIkMSI7IH0KbG9nX2Vycm9yKCkgeyBsb2cgIkVSUk9SIiAiJDEiOyB9CmxvZ19zdWNjZXNzKCkgeyBsb2cgIk9LIiAgIiQxIjsgfQpkaWUoKSB7IGxvZ19lcnJvciAiJDEiOyBleGl0IDE7IH0KCnVzYWdlKCkgeyBlY2hvICJVc2FnZTogJDAgPHVzZXJuYW1lPiBbLS1kcnktcnVuXSBbLS1rZXl0YWIgPHBhdGg+XSBbLS1wcmluY2lwYWwgPG5hbWU+XSI7IGV4aXQgMTsgfQoKbmV0YXBwX2hvbWVfZXhpc3RzKCkgewogICAgbG9jYWwgdXNlcm5hbWU9IiQxIgogICAgbG9jYWwgaHR0cF9jb2RlCiAgICBodHRwX2NvZGU9JChjdXJsIC1zayAtdSAiJE5FVEFQUF9DUkVEUyIgLW8gL2Rldi9udWxsIC13ICIle2h0dHBfY29kZX0iIFwKICAgICAgICAiJHtORVRBUFBfQVBJfS9zdG9yYWdlL3ZvbHVtZXMvJHtORVRBUFBfVk9MX1VVSUR9L2ZpbGVzLyR7dXNlcm5hbWV9P3JldHVybl9tZXRhZGF0YT10cnVlIikKICAgIFtbICIkaHR0cF9jb2RlIiA9PSAiMjAwIiBdXQp9CgpuZXRhcHBfZ2V0X2hvbWVfaW5mbygpIHsKICAgIGxvY2FsIHVzZXJuYW1lPSIkMSIKICAgIGN1cmwgLXNrIC11ICIkTkVUQVBQX0NSRURTIiBcCiAgICAgICAgIiR7TkVUQVBQX0FQSX0vc3RvcmFnZS92b2x1bWVzLyR7TkVUQVBQX1ZPTF9VVUlEfS9maWxlcy8ke3VzZXJuYW1lfT9yZXR1cm5fbWV0YWRhdGE9dHJ1ZSIgfCBcCiAgICAgICAganEgLXIgJ3tuYW1lOiAubmFtZSwgc2l6ZTogLnNpemUsIGFjY2Vzc2VkOiAuYWNjZXNzZWRfdGltZSwgbW9kaWZpZWQ6IC5tb2RpZmllZF90aW1lfScKfQoKbmV0YXBwX3F1YXJhbnRpbmVfaG9tZSgpIHsKICAgIGxvY2FsIHVzZXJuYW1lPSIkMSIKICAgIGxvY2FsIHRhcmdldF9uYW1lPSIke3VzZXJuYW1lfV8ke1RJTUVTVEFNUH0iCiAgICBsb2NhbCB0YXJnZXRfcGF0aD0iJHtORVRBUFBfSE9NRV9CQVNFfS8ke1FVQVJBTlRJTkVfRElSfS8ke3RhcmdldF9uYW1lfSIKICAgIGxvY2FsIHNvdXJjZV9wYXRoPSIke05FVEFQUF9IT01FX0JBU0V9LyR7dXNlcm5hbWV9IgogICAgaWYgW1sgIiREUllfUlVOIiA9PSAidHJ1ZSIgXV07IHRoZW4KICAgICAgICBsb2dfaW5mbyAiW0RSWS1SVU5dIFdvdWxkIG1vdmUgJHtzb3VyY2VfcGF0aH0gLT4gJHt0YXJnZXRfcGF0aH0iCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCiAgICBzc2ggLW8gQmF0Y2hNb2RlPXllcyAtbyBDb25uZWN0VGltZW91dD0xMCAiJE5FVEFQUF9TU0hfSE9TVCIgIm1rZGlyIC1wICR7TkVUQVBQX0hPTUVfQkFTRX0vJHtRVUFSQU5USU5FX0RJUn07IG12ICR7c291cmNlX3BhdGh9ICR7dGFyZ2V0X3BhdGh9IgogICAgbG9nX3N1Y2Nlc3MgIk1vdmVkICR7c291cmNlX3BhdGh9IC0+ICR7dGFyZ2V0X3BhdGh9Igp9CgpjaGVja19rZXJiZXJvcygpIHsKICAgIGlmIGtsaXN0IC1zIDI+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgbG9nX2luZm8gIkV4aXN0aW5nIEtlcmJlcm9zIHRpY2tldCBpcyB2YWxpZCIKICAgICAgICByZXR1cm4gMAogICAgZmkKICAgIGxvZ19pbmZvICJObyB2YWxpZCBLZXJiZXJvcyB0aWNrZXQsIGF1dGhlbnRpY2F0aW5nIHdpdGgga2V5dGFiLi4uIgogICAgW1sgLWYgIiRJUEFfS0VZVEFCIiBdXSB8fCBkaWUgIktleXRhYiBmaWxlIG5vdCBmb3VuZDogJHtJUEFfS0VZVEFCX30iCiAgICBbWyAtciAiJElQQV9LRVlUQUIiIF1dIHx8IGRpZSAiS2V5dGFiIGZpbGUgbm90IHJlYWRhYmxlOiAke0lQQV9LRVlUQUJ9IgogICAga2luaXQgLWt0ICIkSVBBX0tFWVRBQiIgIiRJUEFfUFJJTkNJUEFMIiB8fCBkaWUgIkZhaWxlZCB0byBhdXRoZW50aWNhdGUgd2l0aCBrZXl0YWIiCiAgICBsb2dfc3VjY2VzcyAiQXV0aGVudGljYXRlZCBhcyAke0lQQV9QUklOQ0lQQUx9IHVzaW5nIGtleXRhYiIKfQoKaXBhX2ZpbmRfdXNlcigpIHsKICAgIGxvY2FsIHNlYXJjaF90ZXJtPSIkMSIKICAgIGxvY2FsIGlwYV91aWQKICAgIGxvZ19pbmZvICJTZWFyY2hpbmcgSVBBIGJ5IHVpZDogJHtzZWFyY2hfdGVybX0iCiAgICBpZiBpcGEgdXNlci1zaG93ICIkc2VhcmNoX3Rlcm0iICY+L2Rldi9udWxsOyB0aGVuCiAgICAgICAgZWNobyAiJHNlYXJjaF90ZXJtIgogICAgICAgIHJldHVybiAwCiAgICBmaQogICAgbG9nX2luZm8gIlNlYXJjaGluZyBJUEEgYnkgZnVsbCBuYW1lIChjbik6ICR7c2VhcmNoX3Rlcm19IgogICAgaXBhX3VpZD0kKGlwYSB1c2VyLWZpbmQgLS1jbj0iJHNlYXJjaF90ZXJtIiAtLXJhdyAyPi9kZXYvbnVsbCB8IGdyZXAgIl4gIHVpZDoiIHwgaGVhZCAtMSB8IGF3ayAne3ByaW50ICQyfScpCiAgICBpZiBbWyAtbiAiJGlwYV91aWQiIF1dOyB0aGVuCiAgICAgICAgbG9nX2luZm8gIkZvdW5kIHVzZXIgYnkgY246ICR7aXBhX3VpZH0iCiAgICAgICAgZWNobyAiJGlwYV91aWQiCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCiAgICByZXR1cm4gMQp9CgppcGFfZ2V0X3VzZXJfaW5mbygpIHsKICAgIGxvY2FsIHVzZXJuYW1lPSIkMSIKICAgIGlwYSB1c2VyLXNob3cgIiR1c2VybmFtZSIgLS1hbGwgLS1yYXcgMj4vZGV2L251bGwgfCBncmVwIC1FICJeICAodWlkfGNufG1haWx8dWlkbnVtYmVyfGhvbWVkaXJlY3Rvcnl8bnNhY2NvdW50bG9jayk6IiB8fCB0cnVlCn0KCmlwYV9kaXNhYmxlX3VzZXIoKSB7CiAgICBsb2NhbCB1c2VybmFtZT0iJDEiCiAgICBpZiBbWyAiJERSWV9SVU4iID09ICJ0cnVlIiBdXTsgdGhlbgogICAgICAgIGxvZ19pbmZvICJbRFJZLVJVTl0gV291bGQgZGlzYWJsZSBJUEEgdXNlcjogJHt1c2VybmFtZX0iCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCiAgICBsb2NhbCBvdXRwdXQKICAgIG91dHB1dD0kKGlwYSB1c2VyLWRpc2FibGUgIiR1c2VybmFtZSIgMj4mMSkgJiYgbG9nX3N1Y2Nlc3MgIkRpc2FibGVkIElQQSB1c2VyOiAke3VzZXJuYW1lfSIgfHwgbG9nX3dhcm4gIkZhaWxlZCB0byBkaXNhYmxlIChtYXkgYWxyZWFkeSBiZSBkaXNhYmxlZCk6ICR7b3V0cHV0fSIKfQoKaXBhX2RlbGV0ZV91c2VyKCkgewogICAgbG9jYWwgdXNlcm5hbWU9IiQxIgogICAgaWYgW1sgIiREUllfUlVOIiA9PSAidHJ1ZSIgXV07IHRoZW4KICAgICAgICBsb2dfaW5mbyAiW0RSWS1SVU5dIFdvdWxkIGRlbGV0ZSBJUEEgdXNlcjogJHt1c2VybmFtZX0iCiAgICAgICAgcmV0dXJuIDAKICAgIGZpCiAgICBsb2NhbCBvdXRwdXQKICAgIG91dHB1dD0kKGlwYSB1c2VyLWRlbCAiJHVzZXJuYW1lIiAyPiYxKSAmJiBsb2dfc3VjY2VzcyAiRGVsZXRlZCBJUEEgdXNlcjogJHt1c2VybmFtZX0iIHx8IGxvZ19lcnJvciAiRmFpbGVkIHRvIGRlbGV0ZTogJHtvdXRwdXR9Igp9CgptYWluKCkgewogICAgVVNFUl9JRD0iIgogICAgRFJZX1JVTj0iZmFsc2UiCiAgICB3aGlsZSBbWyAkIyAtZ3QgMCBdXTsgZG8KICAgICAgICBjYXNlICIkMSIgaW4KICAgICAgICAgICAgLS1kcnktcnVuKSBEUllfUlVOPSJ0cnVlIjsgc2hpZnQgOzsKICAgICAgICAgICAgLS1rZXl0YWIpIElQQV9LRVlUQUI9IiQyIjsgc2hpZnQgMiA7OwogICAgICAgICAgICAtLXByaW5jaXBhbCkgSVBBX1BSSU5DSVBBTD0iJDIiOyBzaGlmdCAyIDs7CiAgICAgICAgICAgIC0taGVscHwtaCkgdXNhZ2UgOzsKICAgICAgICAgICAgLSopIGRpZSAiVW5rbm93biBvcHRpb246ICQxIiA7OwogICAgICAgICAgICAqKSBbWyAteiAiJFVTRVJfSUQiIF1dICYmIFVTRVJfSUQ9IiQxIiB8fCBkaWUgIlVuZXhwZWN0ZWQgYXJndW1lbnQ6ICQxIjsgc2hpZnQgOzsKICAgICAgICBlc2FjCiAgICBkb25lCiAgICBbWyAteiAiJFVTRVJfSUQiIF1dICYmIGRpZSAiTm8gdXNlciBzcGVjaWZpZWQiCiAgICBbWyAiJERSWV9SVU4iID09ICJ0cnVlIiBdXSAmJiBsb2dfaW5mbyAiPT09IERSWS1SVU4gTU9ERSAtIE5vIGNoYW5nZXMgd2lsbCBiZSBtYWRlID09PSIKICAgIGxvZ19pbmZvICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIKICAgIGxvZ19pbmZvICJTdGFydGluZyBvZmZib2FyZCBwcm9jZXNzIGZvcjogJHtVU0VSX0lEfSIKICAgIGxvZ19pbmZvICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIKICAgIGNvbW1hbmQgLXYgY3VybCAmPi9kZXYvbnVsbCB8fCBkaWUgImN1cmwgaXMgcmVxdWlyZWQiCiAgICBjb21tYW5kIC12IGpxICY+L2Rldi9udWxsIHx8IGRpZSAianEgaXMgcmVxdWlyZWQiCiAgICBjb21tYW5kIC12IGlwYSAmPi9kZXYvbnVsbCB8fCBkaWUgImlwYSBjb21tYW5kIGlzIHJlcXVpcmVkIgogICAgY2hlY2tfa2VyYmVyb3MKICAgIGxvZ19pbmZvICJTdGVwIDE6IFNlYXJjaGluZyBmb3IgdXNlciBpbiBJUEEuLi4iCiAgICBJUEFfVVNFUk5BTUU9JChpcGFfZmluZF91c2VyICIkVVNFUl9JRCIpIHx8IGRpZSAiVXNlciBub3QgZm91bmQgaW4gSVBBOiAke1VTRVJfSUR9IgogICAgW1sgIiRJUEFfVVNFUk5BTUUiICE9ICIkVVNFUl9JRCIgXV0gJiYgbG9nX2luZm8gIklucHV0ICcke1VTRVJfSUR9JyByZXNvbHZlZCB0byBJUEEgdXNlcm5hbWU6ICR7SVBBX1VTRVJOQU1FfSIgJiYgVVNFUl9JRD0iJElQQV9VU0VSTkFNRSIKICAgIGxvZ19zdWNjZXNzICJVc2VyIGZvdW5kIGluIElQQTogJHtVU0VSX0lEfSIKICAgIGxvZ19pbmZvICJJUEEgVXNlciBJbmZvOiIKICAgIGlwYV9nZXRfdXNlcl9pbmZvICIkVVNFUl9JRCIKICAgIGxvZ19pbmZvICJTdGVwIDI6IENoZWNraW5nIE5ldEFwcCBob21lIGRpcmVjdG9yeS4uLiIKICAgIGlmIG5ldGFwcF9ob21lX2V4aXN0cyAiJFVTRVJfSUQiOyB0aGVuCiAgICAgICAgbG9nX3N1Y2Nlc3MgIkhvbWUgZGlyZWN0b3J5IGZvdW5kIG9uIE5ldEFwcDogJHtORVRBUFBfSE9NRV9CQVNFfS8ke1VTRVJfSUR9IgogICAgICAgIG5ldGFwcF9nZXRfaG9tZV9pbmZvICIkVVNFUl9JRCIKICAgICAgICBORVRBUFBfSE9NRV9GT1VORD0idHJ1ZSIKICAgIGVsc2UKICAgICAgICBsb2dfd2FybiAiSG9tZSBkaXJlY3RvcnkgTk9UIGZvdW5kIG9uIE5ldEFwcDogJHtORVRBUFBfSE9NRV9CQVNFfS8ke1VTRVJfSUR9IgogICAgICAgIE5FVEFQUF9IT01FX0ZPVU5EPSJmYWxzZSIKICAgIGZpCiAgICBsb2dfaW5mbyAiU3RlcCAzOiBEaXNhYmxpbmcgSVBBIHVzZXIuLi4iCiAgICBpcGFfZGlzYWJsZV91c2VyICIkVVNFUl9JRCIKICAgIGxvZ19pbmZvICJTdGVwIDQ6IERlbGV0aW5nIElQQSB1c2VyLi4uIgogICAgaXBhX2RlbGV0ZV91c2VyICIkVVNFUl9JRCIKICAgIGxvZ19pbmZvICJTdGVwIDU6IFF1YXJhbnRpbmluZyBOZXRBcHAgaG9tZSBkaXJlY3RvcnkuLi4iCiAgICBbWyAiJE5FVEFQUF9IT01FX0ZPVU5EIiA9PSAidHJ1ZSIgXV0gJiYgbmV0YXBwX3F1YXJhbnRpbmVfaG9tZSAiJFVTRVJfSUQiIHx8IGxvZ19pbmZvICJTa2lwcGluZyBOZXRBcHAgY2xlYW51cCAtIG5vIGhvbWUgZGlyZWN0b3J5IGZvdW5kIgogICAgbG9nX2luZm8gIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IgogICAgbG9nX3N1Y2Nlc3MgIk9mZmJvYXJkIGNvbXBsZXRlIGZvcjogJHtVU0VSX0lEfSIKICAgIGxvZ19pbmZvICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIKICAgIFtbICIkRFJZX1JVTiIgPT0gInRydWUiIF1dICYmIGxvZ19pbmZvICJUaGlzIHdhcyBhIERSWS1SVU4uIE5vIGNoYW5nZXMgd2VyZSBtYWRlLiIKfQoKbWFpbiAiJEAi
EOF
chmod +x ipa_ad_user_cleanup.sh
