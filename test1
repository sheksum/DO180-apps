---
- name: Register multiple systems to Red Hat Satellite using hammer-generated command
  hosts: all
  become: true
  gather_facts: false

  vars_prompt:
    - name: activation_key
      prompt: "Enter activation key"
      private: no
    - name: hostgroup
      prompt: "Enter host group name"
      private: no

  pre_tasks:
    - name: Generate host registration command from Satellite
      delegate_to: localhost
      shell: |
        hammer host-registration generate-command \
          --activation-keys "{{ activation_key }}" \
          --hostgroup "{{ hostgroup }}" \
          --location "{{ location }}" \
          --organization "{{ org }}" \
          --output-script false
      register: registration_cmd
      run_once: true

    - name: Save registration command
      set_fact:
        satellite_register_cmd: "{{ registration_cmd.stdout_lines[0] }}"
      run_once: true

  tasks:
    - name: Run Satellite registration command on client
      shell: "{{ satellite_register_cmd }}"
