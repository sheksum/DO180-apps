hsuma@plnx-admin:~/haj/ansible-setup-hosts/playground$ vi user-playbook.yml 

  hosts: all
  become: yes

  vars:
    deploy_user: "deploy"
    deploy_password: "school1"
    deploy_home: "/opt/home/{{ deploy_user }}"

  tasks:
    - name: Ensure alternative home base directory exists
      file:
        path: "/opt/home"
        state: directory
        mode: '0755'

    - name: Ensure deploy user exists
      user:
        name: "{{ deploy_user }}"
        password: "{{ deploy_password | password_hash('sha512') }}"
        home: "{{ deploy_home }}"
        shell: /bin/bash
        state: present
        create_home: no

    - name: Create home directory for deploy user if it does not exist
      file:
        path: "{{ deploy_home }}"
        state: directory
        owner: "{{ deploy_user }}"
        group: "{{ deploy_user }}"
        mode: '0755'

    - name: Ensure deploy user has sudo privileges
      copy:
        dest: "/etc/sudoers.d/{{ deploy_user }}"
        content: "{{ deploy_user }} ALL=(ALL) NOPASSWD: ALL"
        mode: '0440'




    - name: Ensure deploy user exists with the appropriate secondary group
      user:
        name: deploy
        comment: "Deploy User"
        shell: /bin/bash
        password: "{{ '$1$fRavZPON$FNe8f/Hn2ejbnCACMHQZa.' }}"
        state: present
        groups: "{{ secondary_group }}"
        home: /opt/home/deploy
        create_home: yes
