replicaCount: 1
namespace: ai-services
nameOverride: ""
fullnameOverride: ""

image:
  repository: us-central1-docker.pkg.dev/ai-dev-458317/triton-images/triton-embeddinggemma
  tag: v2
  pullPolicy: IfNotPresent

serviceAccount:
  create: true
  name: ai-model-embedding-service

model:
  localDir: /models/embeddinggemma-300m
  gcsUri: gs://perf-dev-calix-hf-model-data/models/embeddinggemma-300m/*
  initImage: gcr.io/google.com/cloudsdktool/cloud-sdk:slim

container:
  name: tritonserver
  args:
    - "tritonserver"
    - "--model-repository=/models"
    - "--allow-grpc=true"
    - "--allow-http=true"
    - "--grpc-port=8001"
    - "--http-port=8000"
    - "--metrics-port=8002"
  ports:
    http: 8000
    grpc: 8001
    metrics: 8002
  env:
    - name: EMBEDDING_MODEL_ID
      value: "google/embeddinggemma-300m"

pvc:
  create: true
  name: model-pvc-embedding
  storage: 500Gi
  accessModes:
    - ReadWriteOnce

tolerations:
  - effect: NoSchedule
    key: nvidia.com/gpu
    operator: Exists
  - effect: NoSchedule
    key: workload
    value: spot

nodeSelector: {}
extraNodeSelector: {}
skipAcceleratorSelector: false
skipNodePoolSelector: false

affinity: {}

resources:
  requests:
    cpu: "4"
    memory: "16Gi"
    nvidia.com/gpu: 1
  limits:
    cpu: "8"
    memory: "32Gi"
    nvidia.com/gpu: 1

readinessProbe:
  httpGet:
    path: /v2/health/ready
    port: 8000
  initialDelaySeconds: 30
  periodSeconds: 10

livenessProbe:
  httpGet:
    path: /v2/health/live
    port: 8000
  initialDelaySeconds: 60
  periodSeconds: 20

volumes:
  - name: model-data
    persistentVolumeClaim:
      claimName: model-pvc-embedding

volumeMounts:
  - name: model-data
    mountPath: /models

labels:
  app: triton-embeddinggemma
  ai.gke.io/model: embeddinggemma-300m
  ai.gke.io/inference-server: triton

service:
  name: triton-embeddinggemma-svc
  type: ClusterIP
  ports:
    - name: http
      port: 80
      targetPort: 8000
    - name: grpc
      port: 8001
      targetPort: 8001
    - name: metrics
      port: 8002
      targetPort: 8002

httpRoute:
  enabled: false

healthCheckPolicy:
  checkIntervalSec: 15
  timeoutSec: 10
  healthyThreshold: 1
  unhealthyThreshold: 10
  requestPath: /v2/health/ready




=====




image:
  repository: us-central1-docker.pkg.dev/clx-iac-core-0drx/pai-docker-dev/ai-guardrails-service
  tag: 1.0.0-81dbse.758d788 #IMAGE_TAG
  pullPolicy: Always
  pullSecrets: [dockersecret]


gcsBucket: dev-calix-hf-model-data


tolerations:
  - key: "large-image"
    operator: "Equal"
    value: "true"
    effect: "NoSchedule"
  - key: "hugging-face"
    operator: "Equal"
    value: "true"
    effect: "NoSchedule"

replicaCount: 1

resources:
  limits:
    memory: "48Gi"
    cpu: "4000m"
  requests:
    cpu: "2000m"
    memory: "24Gi"
    ephemeralStorage: "40Gi"

service:
  type: ClusterIP

healthCheck:
  - enabled: true
    name: ai-guardrails-service
    namespace: ai-services
    port: 8080
    requestPath: /guardrails/api/v1/health
    service:
      name: ai-guardrails-service-svc

httpRoute:
  - enabled: true
    gateway:
      name: internal-http
      namespace: gateways
      sectionName: https
    hostname: "ai-guardrails-service.internal.ai.dev1.xilac.net"
    name: ai-guardrails-service
    namespace: ai-services
    service:
      name: ai-guardrails-service-svc
      namespace: ai-services
      port: 8080

podDisruptionBudget:
  enabled: true

serviceAccountName: ai-guardrails-service

rbac:
  create: true

verticalPodAutoscaler:
  enabled: true

models:
  debertaModel: models/deberta-v3-base-prompt-injection-v2
  toxicModel: models/unbiased-toxic-roberta
  piiModel: models/deberta-v3-base_finetuned_ai4privacy_v2
  languageModel: models/xlm-roberta-base-language-detection

configPath: config

environment:
  APP_NAME: ai-guardrails-service
  LOG_LEVEL: info
  CONFIG_PATH: /app_config.yml   
  DEBERTA_MODEL_PATH: /deberta-v3-base-prompt-injection-v2
  TOXIC_MODEL_PATH: /unbiased-toxic-roberta
  PII_MODEL_PATH: /deberta-v3-base_finetuned_ai4privacy_v2
  LANGUAGE_MODEL_PATH: /xlm-roberta-base-language-detection
  GCS_BUCKET: dev-calix-hf-model-data
  PROJECT_ID: clx-dev-data-svcs-306b
  namespace: ai-services
