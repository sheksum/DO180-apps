---
- name: Remove proxy line from dnf.conf
  hosts: all
  become: true

  tasks:
    - name: Remove proxy from /etc/dnf/dnf.conf
      lineinfile:
        path: /etc/dnf/dnf.conf
        regexp: '^#?proxy='
        state: absent

    - name: Clean dnf cache
      command: dnf clean all
      changed_when: false
      ignore_errors: true